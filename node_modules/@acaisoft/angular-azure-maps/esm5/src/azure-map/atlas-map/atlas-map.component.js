/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ContentChild, ElementRef, EventEmitter, Input, Output, TemplateRef, ViewChild, ViewContainerRef, } from '@angular/core';
import { AtlasPopupDirective } from '../directives/atlas-popup.directive';
import { LoadMapService } from '../utils/load-map.service';
var AtlasMapComponent = /** @class */ (function () {
    function AtlasMapComponent(mapService) {
        this.mapService = mapService;
        this.onMapClick = new EventEmitter();
        this.loaded = new EventEmitter();
        this.customPins = [];
        this.features = [];
        this.pointsArray = [];
        this.cssArray = [];
    }
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.popupAtlas = new atlas.Popup();
        this.mapService.loadedComponenet.next(true);
    };
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.createMap(this._id, this.initialConfig); // Initial map
        this.startMapClickListener(); // Start emitter
    };
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.emitLoaded();
    };
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.emitLoaded = /**
     * @return {?}
     */
    function () {
        if (this.map) {
            this.loaded.emit();
        }
        else {
            setTimeout(this.emitLoaded, 100);
        }
    };
    /**
     * @param {?} id
     * @param {?} config
     * @return {?}
     */
    AtlasMapComponent.prototype.createMap = /**
     * @param {?} id
     * @param {?} config
     * @return {?}
     */
    function (id, config) {
        try {
            this.mapWrapper.nativeElement.setAttribute('id', id);
            this.map = new atlas.Map(id, config); // Init map box
            console.log('Map was created!', this.map);
        }
        catch (e) {
            console.log('CHECK YOUR CONFIG!', e);
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    AtlasMapComponent.prototype.changeMapCamera = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.map.setCamera(options);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    AtlasMapComponent.prototype.changeMapStyle = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.map.setStyle(options);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    AtlasMapComponent.prototype.changeUserInteraction = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        this.map.setUserInteraction(options);
    };
    /**
     * Founding all unique layers from features Array
     * @param AmFeature[] features
     * @returns string[]
     */
    /**
     * Founding all unique layers from features Array
     * @param {?} features
     * @return {?} string[]
     */
    AtlasMapComponent.prototype.findUniqueLayers = /**
     * Founding all unique layers from features Array
     * @param {?} features
     * @return {?} string[]
     */
    function (features) {
        /** @type {?} */
        var allLayers = features.map(function (it) { return it.layer; });
        return Array.from(new Set(allLayers));
    };
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.startMapClickListener = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.map.addEventListener('click', function (e) {
            _this.onMapClick.emit(e.position);
            // On click you emit geo position
        });
    };
    /**
     * Creating popUpContainer and injected to parent Template
     * @param context
     */
    /**
     * Creating popUpContainer and injected to parent Template
     * @param {?} context
     * @return {?}
     */
    AtlasMapComponent.prototype.createComponent = /**
     * Creating popUpContainer and injected to parent Template
     * @param {?} context
     * @return {?}
     */
    function (context) {
        if (this.popupView) {
            this.popupView.destroy();
        }
        this.popupView = this.popupsContainer.createEmbeddedView(this.popupTemplate, context);
    };
    /**
     * @param {?} id
     * @param {?} loc
     * @param {?} clas
     * @return {?}
     */
    AtlasMapComponent.prototype.addItem = /**
     * @param {?} id
     * @param {?} loc
     * @param {?} clas
     * @return {?}
     */
    function (id, loc, clas) {
        /** @type {?} */
        var customHTML;
        /** @type {?} */
        var idItem = clas + id;
        /** @type {?} */
        var pos = new atlas.data.Position(loc.lnt, loc.lng);
        this.cssArray.push(idItem); // Saving existing HTML elements
        customHTML = document.createElement('div');
        customHTML.setAttribute('id', idItem);
        customHTML.setAttribute('class', clas);
        this.map.addHtml(customHTML, pos); // add to map
    };
    /**
     * Drawin point on the map as pins
     * @Incjet createPopups()
     * @param  features
     */
    /**
     * Drawin point on the map as pins
     * \@Incjet createPopups()
     * @param {?} features
     * @return {?}
     */
    AtlasMapComponent.prototype.createPoints = /**
     * Drawin point on the map as pins
     * \@Incjet createPopups()
     * @param {?} features
     * @return {?}
     */
    function (features) {
        var e_1, _a;
        if (features.length === 0) {
            console.log('No data available');
            return;
        }
        try {
            for (var features_1 = tslib_1.__values(features), features_1_1 = features_1.next(); !features_1_1.done; features_1_1 = features_1.next()) {
                var item = features_1_1.value;
                this.map.addPins([item.atlasFeature], item.pinConfig);
                if (item.atlasFeature.properties.cssClass) {
                    this.addItem(item.dataElement.id, item.dataElement.localization, item.atlasFeature.properties.cssClass);
                    this.customPins.push(item.atlasFeature.properties.cssClass);
                }
                this.pointsArray.push(item.atlasFeature);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (features_1_1 && !features_1_1.done && (_a = features_1.return)) _a.call(features_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.createPopups(features);
    };
    /**
     * Created popUps for all features by type of layers
     * Adding event on 'mouseover'
     * @param features
     */
    /**
     * Created popUps for all features by type of layers
     * Adding event on 'mouseover'
     * @param {?} features
     * @return {?}
     */
    AtlasMapComponent.prototype.createPopups = /**
     * Created popUps for all features by type of layers
     * Adding event on 'mouseover'
     * @param {?} features
     * @return {?}
     */
    function (features) {
        var _this = this;
        var e_2, _a;
        try {
            for (var _b = tslib_1.__values(this.findUniqueLayers(features)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var item = _c.value;
                if (this.popupTemplate) {
                    this.map.addEventListener('mouseover', item, function (e) {
                        /** @type {?} */
                        var amFeature = features.find(function (it) { return it.dataElement.name === e.features[0].properties.name; });
                        _this.createComponent({
                            /**
                                         * sent to template variable
                                         * raw data from input
                                         */
                            dataElement: amFeature.dataElement
                        });
                        _this.popupAtlas.setPopupOptions({
                            position: e.features[0].geometry.coordinates,
                            content: document.getElementById("popupWrapper"),
                        });
                        _this.popupAtlas.open(_this.map);
                    });
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    /**
     * @param {?} features
     * @return {?}
     */
    AtlasMapComponent.prototype.updatePoints = /**
     * @param {?} features
     * @return {?}
     */
    function (features) {
        var _this = this;
        this.map.removeLayers(this.findUniqueLayers(features));
        if (this.cssArray.length) {
            this.cssArray.forEach(function (value) {
                (/** @type {?} */ (document.querySelectorAll("#" + value))).forEach(function (it) { return it.remove(); });
                _this.map.removeHtml(value);
            });
            this.cssArray = [];
        }
        this.createPoints(features);
    };
    /**
     * @return {?}
     */
    AtlasMapComponent.prototype.removeMap = /**
     * @return {?}
     */
    function () {
        this.map.remove();
    };
    AtlasMapComponent.decorators = [
        { type: Component, args: [{
                    selector: 'am-map',
                    template: "<div #mapWrapper class=\"atlas-map\"></div>\n\n<div id=\"popupWrapper\">\n  <div #popupsContainer>\n  </div>\n</div>\n\n\n\n\n",
                    styles: [".atlas-map{position:relative;width:100%;height:100%}"]
                },] },
    ];
    /** @nocollapse */
    AtlasMapComponent.ctorParameters = function () { return [
        { type: LoadMapService }
    ]; };
    AtlasMapComponent.propDecorators = {
        initialConfig: [{ type: Input }],
        _id: [{ type: Input }],
        onMapClick: [{ type: Output }],
        loaded: [{ type: Output }],
        popupsContainer: [{ type: ViewChild, args: ['popupsContainer', { read: ViewContainerRef },] }],
        mapWrapper: [{ type: ViewChild, args: ['mapWrapper', { read: ElementRef },] }],
        popupTemplate: [{ type: ContentChild, args: [AtlasPopupDirective, { read: TemplateRef },] }]
    };
    return AtlasMapComponent;
}());
export { AtlasMapComponent };
if (false) {
    /** @type {?} */
    AtlasMapComponent.prototype.initialConfig;
    /** @type {?} */
    AtlasMapComponent.prototype._id;
    /** @type {?} */
    AtlasMapComponent.prototype.onMapClick;
    /** @type {?} */
    AtlasMapComponent.prototype.loaded;
    /** @type {?} */
    AtlasMapComponent.prototype.popupsContainer;
    /** @type {?} */
    AtlasMapComponent.prototype.mapWrapper;
    /**
     * For create and control popup
     * To Inject into ng-template in parent
     * @type {?}
     */
    AtlasMapComponent.prototype.popupTemplate;
    /** @type {?} */
    AtlasMapComponent.prototype.popupView;
    /** @type {?} */
    AtlasMapComponent.prototype.popupAtlas;
    /** @type {?} */
    AtlasMapComponent.prototype.map;
    /** @type {?} */
    AtlasMapComponent.prototype.customPins;
    /** @type {?} */
    AtlasMapComponent.prototype.features;
    /** @type {?} */
    AtlasMapComponent.prototype.pointsArray;
    /** @type {?} */
    AtlasMapComponent.prototype.cssArray;
    /** @type {?} */
    AtlasMapComponent.prototype.mapService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXRsYXMtbWFwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhY2Fpc29mdC9hbmd1bGFyLWF6dXJlLW1hcHMvIiwic291cmNlcyI6WyJzcmMvYXp1cmUtbWFwL2F0bGFzLW1hcC9hdGxhcy1tYXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUdMLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUVWLFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1QsZ0JBQWdCLEdBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3hFLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQzs7SUEyQ3ZELDJCQUFvQixVQUEwQjtRQUExQixlQUFVLEdBQVYsVUFBVSxDQUFnQjswQkFyQnZCLElBQUksWUFBWSxFQUF1QjtzQkFDeEIsSUFBSSxZQUFZLEVBQUU7MEJBZXZCLEVBQUU7d0JBQ0osRUFBRTsyQkFDVyxFQUFFO3dCQUNqQixFQUFFO0tBRzlCOzs7O0lBRUQsb0NBQVE7OztJQUFSO1FBQ0UsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUU3Qzs7OztJQUVELDhDQUFrQjs7O0lBQWxCO1FBQ0UsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztLQUM5Qjs7OztJQUVELDJDQUFlOzs7SUFBZjtRQUNFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztLQUNuQjs7OztJQUVELHNDQUFVOzs7SUFBVjtRQUNF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Z0IsQ0FBQyxNQUFJLEtBQU8sQ0FBUSxFQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsRUFBRSxJQUFJLE9BQUEsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFYLENBQVcsQ0FBQyxDQUFDO2dCQUMzRSxLQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUM1QixDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztTQUNwQjtRQUNELElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDN0I7Ozs7SUFFRCxxQ0FBUzs7O0lBQVQ7UUFDRSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQ25COztnQkFsTUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxRQUFRO29CQUNsQixRQUFRLEVBQUUsZ0lBVVg7b0JBQ0MsTUFBTSxFQUFFLENBQUMsc0RBQXNELENBQUM7aUJBQ2pFOzs7O2dCQWhCTyxjQUFjOzs7Z0NBa0JuQixLQUFLO3NCQUNMLEtBQUs7NkJBR0wsTUFBTTt5QkFDTixNQUFNO2tDQUVOLFNBQVMsU0FBQyxpQkFBaUIsRUFBRSxFQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBQzs2QkFDckQsU0FBUyxTQUFDLFlBQVksRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUM7Z0NBTTFDLFlBQVksU0FBQyxtQkFBbUIsRUFBRSxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUM7OzRCQW5EeEQ7O1NBb0NhLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi9hdGxhc1wiLz5cblxuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIEVsZW1lbnRSZWYsXG4gIEVtYmVkZGVkVmlld1JlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBbUZlYXR1cmV9IGZyb20gJy4uL2ludGVyZmFjZXMvYW0tZmVhdHVyZSc7XG5pbXBvcnQge0F0bGFzUG9wdXBEaXJlY3RpdmV9IGZyb20gJy4uL2RpcmVjdGl2ZXMvYXRsYXMtcG9wdXAuZGlyZWN0aXZlJztcbmltcG9ydCB7TG9hZE1hcFNlcnZpY2V9IGZyb20gJy4uL3V0aWxzL2xvYWQtbWFwLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhbS1tYXAnLFxuICB0ZW1wbGF0ZTogYDxkaXYgI21hcFdyYXBwZXIgY2xhc3M9XCJhdGxhcy1tYXBcIj48L2Rpdj5cblxuPGRpdiBpZD1cInBvcHVwV3JhcHBlclwiPlxuICA8ZGl2ICNwb3B1cHNDb250YWluZXI+XG4gIDwvZGl2PlxuPC9kaXY+XG5cblxuXG5cbmAsXG4gIHN0eWxlczogW2AuYXRsYXMtbWFwe3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCV9YF1cbn0pXG5leHBvcnQgY2xhc3MgQXRsYXNNYXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQsIEFmdGVyVmlld0luaXQge1xuICBASW5wdXQoKSBpbml0aWFsQ29uZmlnOiBhbnk7XG4gIEBJbnB1dCgpIF9pZDogc3RyaW5nO1xuXG5cbiAgQE91dHB1dCgpIG9uTWFwQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPGF0bGFzLmRhdGEuUG9zaXRpb24+KCk7XG4gIEBPdXRwdXQoKSBsb2FkZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3BvcHVwc0NvbnRhaW5lcicsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmfSkgcG9wdXBzQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuICBAVmlld0NoaWxkKCdtYXBXcmFwcGVyJywge3JlYWQ6IEVsZW1lbnRSZWZ9KSBtYXBXcmFwcGVyOiBFbGVtZW50UmVmO1xuXG4gIC8qKlxuICAgKiBGb3IgY3JlYXRlIGFuZCBjb250cm9sIHBvcHVwXG4gICAqIFRvIEluamVjdCBpbnRvIG5nLXRlbXBsYXRlIGluIHBhcmVudFxuICAgKi9cbiAgQENvbnRlbnRDaGlsZChBdGxhc1BvcHVwRGlyZWN0aXZlLCB7cmVhZDogVGVtcGxhdGVSZWZ9KSBwb3B1cFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIHB1YmxpYyBwb3B1cFZpZXc6IEVtYmVkZGVkVmlld1JlZjxhbnk+O1xuICBwdWJsaWMgcG9wdXBBdGxhczogYXRsYXMuUG9wdXA7XG5cbiAgcHVibGljIG1hcDogYXRsYXMuTWFwO1xuICBwcml2YXRlIGN1c3RvbVBpbnM6IEFycmF5PGFueT4gPSBbXTtcbiAgcHVibGljIGZlYXR1cmVzOiBBbUZlYXR1cmVbXSA9IFtdOyAvLyBBcnJheSBvZiBvdXJzIHBvaW50cyB0byBhZGQgb24gbWFwXG4gIHByaXZhdGUgcG9pbnRzQXJyYXk6IGF0bGFzLmRhdGEuRmVhdHVyZVtdID0gW107XG4gIHByaXZhdGUgY3NzQXJyYXk6IHN0cmluZ1tdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtYXBTZXJ2aWNlOiBMb2FkTWFwU2VydmljZSkge1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5wb3B1cEF0bGFzID0gbmV3IGF0bGFzLlBvcHVwKCk7XG4gICAgdGhpcy5tYXBTZXJ2aWNlLmxvYWRlZENvbXBvbmVuZXQubmV4dCh0cnVlKTtcblxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuY3JlYXRlTWFwKHRoaXMuX2lkLCB0aGlzLmluaXRpYWxDb25maWcpOyAvLyBJbml0aWFsIG1hcFxuICAgIHRoaXMuc3RhcnRNYXBDbGlja0xpc3RlbmVyKCk7IC8vIFN0YXJ0IGVtaXR0ZXJcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmVtaXRMb2FkZWQoKTtcbiAgfVxuXG4gIGVtaXRMb2FkZWQoKSB7XG4gICAgaWYgKHRoaXMubWFwKSB7XG4gICAgICB0aGlzLmxvYWRlZC5lbWl0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFRpbWVvdXQodGhpcy5lbWl0TG9hZGVkLCAxMDApO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVNYXAoaWQ6IHN0cmluZywgY29uZmlnOiBhbnkpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5tYXBXcmFwcGVyLm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIGlkKTtcbiAgICAgIHRoaXMubWFwID0gbmV3IGF0bGFzLk1hcChpZCwgY29uZmlnKTsgLy8gSW5pdCBtYXAgYm94XG4gICAgICBjb25zb2xlLmxvZygnTWFwIHdhcyBjcmVhdGVkIScsIHRoaXMubWFwKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnQ0hFQ0sgWU9VUiBDT05GSUchJywgZSk7XG4gICAgfVxuICB9XG5cbiAgY2hhbmdlTWFwQ2FtZXJhKG9wdGlvbnM6IENhbWVyYU9wdGlvbnMgJiBBbmltYXRpb25PcHRpb25zKTogdm9pZCB7XG4gICAgdGhpcy5tYXAuc2V0Q2FtZXJhKG9wdGlvbnMpO1xuICB9XG5cbiAgY2hhbmdlTWFwU3R5bGUob3B0aW9uczogU3R5bGVPcHRpb25zKTogdm9pZCB7XG4gICAgdGhpcy5tYXAuc2V0U3R5bGUob3B0aW9ucyk7XG4gIH1cblxuICBjaGFuZ2VVc2VySW50ZXJhY3Rpb24ob3B0aW9uczogVXNlckludGVyYWN0aW9uT3B0aW9ucyk6IHZvaWQge1xuICAgIHRoaXMubWFwLnNldFVzZXJJbnRlcmFjdGlvbihvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3VuZGluZyBhbGwgdW5pcXVlIGxheWVycyBmcm9tIGZlYXR1cmVzIEFycmF5XG4gICAqIEBwYXJhbSBBbUZlYXR1cmVbXSBmZWF0dXJlc1xuICAgKiBAcmV0dXJucyBzdHJpbmdbXVxuICAgKi9cbiAgZmluZFVuaXF1ZUxheWVycyhmZWF0dXJlczogQW1GZWF0dXJlW10pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYWxsTGF5ZXJzID0gZmVhdHVyZXMubWFwKGl0ID0+IGl0LmxheWVyKTtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGFsbExheWVycykpO1xuICB9XG5cbiAgc3RhcnRNYXBDbGlja0xpc3RlbmVyKCk6IHZvaWQge1xuICAgIHRoaXMubWFwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIHRoaXMub25NYXBDbGljay5lbWl0KGUucG9zaXRpb24pO1xuICAgICAgLy8gT24gY2xpY2sgeW91IGVtaXQgZ2VvIHBvc2l0aW9uXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRpbmcgcG9wVXBDb250YWluZXIgYW5kIGluamVjdGVkIHRvIHBhcmVudCBUZW1wbGF0ZVxuICAgKiBAcGFyYW0gY29udGV4dFxuICAgKi9cbiAgY3JlYXRlQ29tcG9uZW50KGNvbnRleHQ6IGFueSk6IHZvaWQge1xuICAgIGlmICh0aGlzLnBvcHVwVmlldykge1xuICAgICAgdGhpcy5wb3B1cFZpZXcuZGVzdHJveSgpO1xuICAgIH1cbiAgICB0aGlzLnBvcHVwVmlldyA9IHRoaXMucG9wdXBzQ29udGFpbmVyLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLnBvcHVwVGVtcGxhdGUsIGNvbnRleHQpO1xuICB9XG5cbiAgYWRkSXRlbShpZCwgbG9jLCBjbGFzKTogdm9pZCB7XG4gICAgbGV0IGN1c3RvbUhUTUw7XG4gICAgY29uc3QgaWRJdGVtID0gY2xhcyArIGlkO1xuICAgIGNvbnN0IHBvcyA9IG5ldyBhdGxhcy5kYXRhLlBvc2l0aW9uKGxvYy5sbnQsIGxvYy5sbmcpO1xuICAgIHRoaXMuY3NzQXJyYXkucHVzaChpZEl0ZW0pOyAgLy8gU2F2aW5nIGV4aXN0aW5nIEhUTUwgZWxlbWVudHNcblxuICAgIGN1c3RvbUhUTUwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjdXN0b21IVE1MLnNldEF0dHJpYnV0ZSgnaWQnLCBpZEl0ZW0pO1xuICAgIGN1c3RvbUhUTUwuc2V0QXR0cmlidXRlKCdjbGFzcycsIGNsYXMpO1xuXG4gICAgdGhpcy5tYXAuYWRkSHRtbChjdXN0b21IVE1MLCBwb3MpOyAvLyBhZGQgdG8gbWFwXG4gIH1cblxuICAvKipcbiAgICogRHJhd2luIHBvaW50IG9uIHRoZSBtYXAgYXMgcGluc1xuICAgKiBASW5jamV0IGNyZWF0ZVBvcHVwcygpXG4gICAqIEBwYXJhbSAgZmVhdHVyZXNcbiAgICovXG4gIGNyZWF0ZVBvaW50cyhmZWF0dXJlczogQW1GZWF0dXJlW10pOiB2b2lkIHtcbiAgICBpZiAoZmVhdHVyZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnTm8gZGF0YSBhdmFpbGFibGUnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZmVhdHVyZXMpIHtcbiAgICAgIHRoaXMubWFwLmFkZFBpbnMoW2l0ZW0uYXRsYXNGZWF0dXJlXSwgaXRlbS5waW5Db25maWcpO1xuICAgICAgaWYgKGl0ZW0uYXRsYXNGZWF0dXJlLnByb3BlcnRpZXMuY3NzQ2xhc3MpIHtcbiAgICAgICAgdGhpcy5hZGRJdGVtKGl0ZW0uZGF0YUVsZW1lbnQuaWQsIGl0ZW0uZGF0YUVsZW1lbnQubG9jYWxpemF0aW9uLCBpdGVtLmF0bGFzRmVhdHVyZS5wcm9wZXJ0aWVzLmNzc0NsYXNzKTtcbiAgICAgICAgdGhpcy5jdXN0b21QaW5zLnB1c2goaXRlbS5hdGxhc0ZlYXR1cmUucHJvcGVydGllcy5jc3NDbGFzcyk7XG4gICAgICB9XG4gICAgICB0aGlzLnBvaW50c0FycmF5LnB1c2goaXRlbS5hdGxhc0ZlYXR1cmUpO1xuICAgIH1cbiAgICB0aGlzLmNyZWF0ZVBvcHVwcyhmZWF0dXJlcyk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBDcmVhdGVkIHBvcFVwcyBmb3IgYWxsIGZlYXR1cmVzIGJ5IHR5cGUgb2YgbGF5ZXJzXG4gICAqIEFkZGluZyBldmVudCBvbiAnbW91c2VvdmVyJ1xuICAgKiBAcGFyYW0gZmVhdHVyZXNcbiAgICovXG4gIGNyZWF0ZVBvcHVwcyhmZWF0dXJlczogQW1GZWF0dXJlW10pOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5maW5kVW5pcXVlTGF5ZXJzKGZlYXR1cmVzKSkge1xuICAgICAgaWYgKHRoaXMucG9wdXBUZW1wbGF0ZSkge1xuICAgICAgICB0aGlzLm1hcC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBpdGVtLCAoZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFtRmVhdHVyZTogQW1GZWF0dXJlID0gZmVhdHVyZXMuZmluZChpdCA9PiBpdC5kYXRhRWxlbWVudC5uYW1lID09PSBlLmZlYXR1cmVzWzBdLnByb3BlcnRpZXMubmFtZSk7XG4gICAgICAgICAgdGhpcy5jcmVhdGVDb21wb25lbnQoe1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBzZW50IHRvIHRlbXBsYXRlIHZhcmlhYmxlXG4gICAgICAgICAgICAgKiByYXcgZGF0YSBmcm9tIGlucHV0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGRhdGFFbGVtZW50OiBhbUZlYXR1cmUuZGF0YUVsZW1lbnRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLnBvcHVwQXRsYXMuc2V0UG9wdXBPcHRpb25zKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBlLmZlYXR1cmVzWzBdLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuICAgICAgICAgICAgY29udGVudDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBvcHVwV3JhcHBlcmApLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMucG9wdXBBdGxhcy5vcGVuKHRoaXMubWFwKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlUG9pbnRzKGZlYXR1cmVzOiBBbUZlYXR1cmVbXSk6IHZvaWQge1xuICAgIHRoaXMubWFwLnJlbW92ZUxheWVycyh0aGlzLmZpbmRVbmlxdWVMYXllcnMoZmVhdHVyZXMpKTtcbiAgICBpZiAodGhpcy5jc3NBcnJheS5sZW5ndGgpIHtcbiAgICAgIHRoaXMuY3NzQXJyYXkuZm9yRWFjaCh2YWx1ZSA9PiB7XG4gICAgICAgIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAjJHt2YWx1ZX1gKSBhcyBhbnkpLmZvckVhY2goaXQgPT4gaXQucmVtb3ZlKCkpO1xuICAgICAgICB0aGlzLm1hcC5yZW1vdmVIdG1sKHZhbHVlKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jc3NBcnJheSA9IFtdO1xuICAgIH1cbiAgICB0aGlzLmNyZWF0ZVBvaW50cyhmZWF0dXJlcyk7XG4gIH1cblxuICByZW1vdmVNYXAoKSB7XG4gICAgdGhpcy5tYXAucmVtb3ZlKCk7XG4gIH1cblxuXG59XG5cblxuXG4iXX0=