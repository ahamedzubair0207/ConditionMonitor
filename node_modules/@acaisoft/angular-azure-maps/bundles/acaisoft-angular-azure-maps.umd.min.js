!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/internal-compatibility"),require("@angular/common")):"function"==typeof define&&define.amd?define("@acaisoft/angular-azure-maps",["exports","@angular/core","rxjs","rxjs/internal-compatibility","@angular/common"],e):e((t.acaisoft=t.acaisoft||{},t.acaisoft["angular-azure-maps"]={}),t.ng.core,t.rxjs,t.rxjs["internal-compatibility"],t.ng.common)}(this,function(t,e,n,o,r){"use strict";function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}var a=function(){function t(){}return t.decorators=[{type:e.Directive,args:[{selector:"[amPopup]"}]}],t.ctorParameters=function(){return[]},t}(),i=[{type:"style",src:"https://atlas.microsoft.com/sdk/css/atlas.min.css?api-version=1"},{type:"script",src:"https://atlas.microsoft.com/sdk/js/atlas.min.js?api-version=1"}];function s(){return window}function c(){return Promise.all(i.map(function(t){return function e(o,r){return new Promise(function(t,e){var n;switch(r){case"script":(n=document.createElement("script")).src=o;break;case"style":(n=document.createElement("link")).rel="stylesheet",n.href=o,n.type="text/css";break;default:e("Wrong Type")}"undefined"!=typeof s().atlas&&"undefined"!=typeof s().atlas.Map?t():(n.onerror=e,n.onload=t,document.head.appendChild(n))})}(t.src,t.type)}))}var u=function(){function t(){this.isLoaded=!1,this.isComponentLoaded=!1,this.loadedSubject=new n.Subject,this.loadedComponenet=new n.BehaviorSubject(!1)}return t.prototype.load=function(){var t=this;return this.isLoaded?n.of(!0):o.fromPromise(c().then(function(){return t.isLoaded=!0,t.isLoaded}))},t.prototype.observableComponent=function(){return this.loadedSubject.asObservable()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),l=function(){function t(t){this.mapService=t,this.onMapClick=new e.EventEmitter,this.loaded=new e.EventEmitter,this.customPins=[],this.features=[],this.pointsArray=[],this.cssArray=[]}return t.prototype.ngOnInit=function(){this.popupAtlas=new atlas.Popup,this.mapService.loadedComponenet.next(!0)},t.prototype.ngAfterContentInit=function(){this.createMap(this._id,this.initialConfig),this.startMapClickListener()},t.prototype.ngAfterViewInit=function(){this.emitLoaded()},t.prototype.emitLoaded=function(){this.map?this.loaded.emit():setTimeout(this.emitLoaded,100)},t.prototype.createMap=function(t,e){try{this.mapWrapper.nativeElement.setAttribute("id",t),this.map=new atlas.Map(t,e),console.log("Map was created!",this.map)}catch(n){console.log("CHECK YOUR CONFIG!",n)}},t.prototype.changeMapCamera=function(t){this.map.setCamera(t)},t.prototype.changeMapStyle=function(t){this.map.setStyle(t)},t.prototype.changeUserInteraction=function(t){this.map.setUserInteraction(t)},t.prototype.findUniqueLayers=function(t){var e=t.map(function(t){return t.layer});return Array.from(new Set(e))},t.prototype.startMapClickListener=function(){var e=this;this.map.addEventListener("click",function(t){e.onMapClick.emit(t.position)})},t.prototype.createComponent=function(t){this.popupView&&this.popupView.destroy(),this.popupView=this.popupsContainer.createEmbeddedView(this.popupTemplate,t)},t.prototype.addItem=function(t,e,n){var o,r=n+t,a=new atlas.data.Position(e.lnt,e.lng);this.cssArray.push(r),(o=document.createElement("div")).setAttribute("id",r),o.setAttribute("class",n),this.map.addHtml(o,a)},t.prototype.createPoints=function(t){var e,n;if(0!==t.length){try{for(var o=p(t),r=o.next();!r.done;r=o.next()){var a=r.value;this.map.addPins([a.atlasFeature],a.pinConfig),a.atlasFeature.properties.cssClass&&(this.addItem(a.dataElement.id,a.dataElement.localization,a.atlasFeature.properties.cssClass),this.customPins.push(a.atlasFeature.properties.cssClass)),this.pointsArray.push(a.atlasFeature)}}catch(i){e={error:i}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(e)throw e.error}}this.createPopups(t)}else console.log("No data available")},t.prototype.createPopups=function(n){var t,e,o=this;try{for(var r=p(this.findUniqueLayers(n)),a=r.next();!a.done;a=r.next()){var i=a.value;this.popupTemplate&&this.map.addEventListener("mouseover",i,function(e){var t=n.find(function(t){return t.dataElement.name===e.features[0].properties.name});o.createComponent({dataElement:t.dataElement}),o.popupAtlas.setPopupOptions({position:e.features[0].geometry.coordinates,content:document.getElementById("popupWrapper")}),o.popupAtlas.open(o.map)})}}catch(s){t={error:s}}finally{try{a&&!a.done&&(e=r["return"])&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.updatePoints=function(t){var e=this;this.map.removeLayers(this.findUniqueLayers(t)),this.cssArray.length&&(this.cssArray.forEach(function(t){document.querySelectorAll("#"+t).forEach(function(t){return t.remove()}),e.map.removeHtml(t)}),this.cssArray=[]),this.createPoints(t)},t.prototype.removeMap=function(){this.map.remove()},t.decorators=[{type:e.Component,args:[{selector:"am-map",template:'<div #mapWrapper class="atlas-map"></div>\n\n<div id="popupWrapper">\n  <div #popupsContainer>\n  </div>\n</div>\n\n\n\n\n',styles:[".atlas-map{position:relative;width:100%;height:100%}"]}]}],t.ctorParameters=function(){return[{type:u}]},t.propDecorators={initialConfig:[{type:e.Input}],_id:[{type:e.Input}],onMapClick:[{type:e.Output}],loaded:[{type:e.Output}],popupsContainer:[{type:e.ViewChild,args:["popupsContainer",{read:e.ViewContainerRef}]}],mapWrapper:[{type:e.ViewChild,args:["mapWrapper",{read:e.ElementRef}]}],popupTemplate:[{type:e.ContentChild,args:[a,{read:e.TemplateRef}]}]},t}(),d=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[u]}},t.decorators=[{type:e.NgModule,args:[{imports:[r.CommonModule],declarations:[l,a],exports:[l,a],bootstrap:[l]}]}],t}();t.AmModule=d,t.AtlasMapComponent=l,t.LoadMapService=u,t.Éµa=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=acaisoft-angular-azure-maps.umd.min.js.map