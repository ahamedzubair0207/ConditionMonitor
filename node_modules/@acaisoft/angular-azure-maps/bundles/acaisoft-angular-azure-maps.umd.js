(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('rxjs'), require('rxjs/internal-compatibility'), require('@angular/common')) :
    typeof define === 'function' && define.amd ? define('@acaisoft/angular-azure-maps', ['exports', '@angular/core', 'rxjs', 'rxjs/internal-compatibility', '@angular/common'], factory) :
    (factory((global.acaisoft = global.acaisoft || {}, global.acaisoft['angular-azure-maps'] = {}),global.ng.core,global.rxjs,global.rxjs['internal-compatibility'],global.ng.common));
}(this, (function (exports,core,rxjs,internalCompatibility,common) { 'use strict';

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    function __values(o) {
        var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
        if (m)
            return m.call(o);
        return {
            next: function () {
                if (o && i >= o.length)
                    o = void 0;
                return { value: o && o[i++], done: !o };
            }
        };
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var AtlasPopupDirective = /** @class */ (function () {
        function AtlasPopupDirective() {
        }
        AtlasPopupDirective.decorators = [
            { type: core.Directive, args: [{
                        selector: '[amPopup]'
                    },] },
        ];
        /** @nocollapse */
        AtlasPopupDirective.ctorParameters = function () { return []; };
        return AtlasPopupDirective;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    /** @type {?} */
    var sources = [
        {
            type: 'style',
            src: 'https://atlas.microsoft.com/sdk/css/atlas.min.css?api-version=1'
        },
        {
            type: 'script',
            src: 'https://atlas.microsoft.com/sdk/js/atlas.min.js?api-version=1'
        }
    ];
    /**
     * @return {?}
     */
    function _window() {
        return window;
    }
    /**
     * @param {?} source
     * @param {?} type
     * @return {?}
     */
    function loadSingleAsset(source, type) {
        return new Promise(function (resolve, reject) {
            /** @type {?} */
            var createdElement;
            switch (type) {
                case 'script':
                    createdElement = document.createElement('script');
                    createdElement.src = source;
                    break;
                case 'style':
                    createdElement = document.createElement('link');
                    createdElement.rel = 'stylesheet';
                    createdElement.href = source;
                    createdElement.type = 'text/css';
                    break;
                default:
                    reject('Wrong Type');
                    break;
            }
            if (typeof (_window().atlas) !== 'undefined'
                && typeof (_window().atlas.Map) !== 'undefined') {
                resolve();
            }
            else {
                createdElement.onerror = reject;
                createdElement.onload = resolve;
                document.head.appendChild(createdElement);
            }
        });
    }
    /**
     * @return {?}
     */
    function azureMapLazyLoader() {
        return Promise.all(sources.map(function (source) { return loadSingleAsset(source.src, source.type); }));
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var LoadMapService = /** @class */ (function () {
        function LoadMapService() {
            this.isLoaded = false;
            this.isComponentLoaded = false;
            this.loadedSubject = new rxjs.Subject();
            this.loadedComponenet = new rxjs.BehaviorSubject(false);
        }
        /**
         * @return {?}
         */
        LoadMapService.prototype.load = /**
         * @return {?}
         */
            function () {
                var _this = this;
                if (!this.isLoaded) {
                    return internalCompatibility.fromPromise(azureMapLazyLoader().then(function () {
                        _this.isLoaded = true;
                        return _this.isLoaded;
                    }));
                }
                else {
                    return rxjs.of(true);
                }
            };
        /**
         * @return {?}
         */
        LoadMapService.prototype.observableComponent = /**
         * @return {?}
         */
            function () {
                return this.loadedSubject.asObservable();
            };
        LoadMapService.decorators = [
            { type: core.Injectable },
        ];
        /** @nocollapse */
        LoadMapService.ctorParameters = function () { return []; };
        return LoadMapService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var AtlasMapComponent = /** @class */ (function () {
        function AtlasMapComponent(mapService) {
            this.mapService = mapService;
            this.onMapClick = new core.EventEmitter();
            this.loaded = new core.EventEmitter();
            this.customPins = [];
            this.features = [];
            this.pointsArray = [];
            this.cssArray = [];
        }
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.ngOnInit = /**
         * @return {?}
         */
            function () {
                this.popupAtlas = new atlas.Popup();
                this.mapService.loadedComponenet.next(true);
            };
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.ngAfterContentInit = /**
         * @return {?}
         */
            function () {
                this.createMap(this._id, this.initialConfig); // Initial map
                this.startMapClickListener(); // Start emitter
            };
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.ngAfterViewInit = /**
         * @return {?}
         */
            function () {
                this.emitLoaded();
            };
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.emitLoaded = /**
         * @return {?}
         */
            function () {
                if (this.map) {
                    this.loaded.emit();
                }
                else {
                    setTimeout(this.emitLoaded, 100);
                }
            };
        /**
         * @param {?} id
         * @param {?} config
         * @return {?}
         */
        AtlasMapComponent.prototype.createMap = /**
         * @param {?} id
         * @param {?} config
         * @return {?}
         */
            function (id, config) {
                try {
                    this.mapWrapper.nativeElement.setAttribute('id', id);
                    this.map = new atlas.Map(id, config); // Init map box
                    console.log('Map was created!', this.map);
                }
                catch (e) {
                    console.log('CHECK YOUR CONFIG!', e);
                }
            };
        /**
         * @param {?} options
         * @return {?}
         */
        AtlasMapComponent.prototype.changeMapCamera = /**
         * @param {?} options
         * @return {?}
         */
            function (options) {
                this.map.setCamera(options);
            };
        /**
         * @param {?} options
         * @return {?}
         */
        AtlasMapComponent.prototype.changeMapStyle = /**
         * @param {?} options
         * @return {?}
         */
            function (options) {
                this.map.setStyle(options);
            };
        /**
         * @param {?} options
         * @return {?}
         */
        AtlasMapComponent.prototype.changeUserInteraction = /**
         * @param {?} options
         * @return {?}
         */
            function (options) {
                this.map.setUserInteraction(options);
            };
        /**
         * Founding all unique layers from features Array
         * @param AmFeature[] features
         * @returns string[]
         */
        /**
         * Founding all unique layers from features Array
         * @param {?} features
         * @return {?} string[]
         */
        AtlasMapComponent.prototype.findUniqueLayers = /**
         * Founding all unique layers from features Array
         * @param {?} features
         * @return {?} string[]
         */
            function (features) {
                /** @type {?} */
                var allLayers = features.map(function (it) { return it.layer; });
                return Array.from(new Set(allLayers));
            };
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.startMapClickListener = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.map.addEventListener('click', function (e) {
                    _this.onMapClick.emit(e.position);
                    // On click you emit geo position
                });
            };
        /**
         * Creating popUpContainer and injected to parent Template
         * @param context
         */
        /**
         * Creating popUpContainer and injected to parent Template
         * @param {?} context
         * @return {?}
         */
        AtlasMapComponent.prototype.createComponent = /**
         * Creating popUpContainer and injected to parent Template
         * @param {?} context
         * @return {?}
         */
            function (context) {
                if (this.popupView) {
                    this.popupView.destroy();
                }
                this.popupView = this.popupsContainer.createEmbeddedView(this.popupTemplate, context);
            };
        /**
         * @param {?} id
         * @param {?} loc
         * @param {?} clas
         * @return {?}
         */
        AtlasMapComponent.prototype.addItem = /**
         * @param {?} id
         * @param {?} loc
         * @param {?} clas
         * @return {?}
         */
            function (id, loc, clas) {
                /** @type {?} */
                var customHTML;
                /** @type {?} */
                var idItem = clas + id;
                /** @type {?} */
                var pos = new atlas.data.Position(loc.lnt, loc.lng);
                this.cssArray.push(idItem); // Saving existing HTML elements
                customHTML = document.createElement('div');
                customHTML.setAttribute('id', idItem);
                customHTML.setAttribute('class', clas);
                this.map.addHtml(customHTML, pos); // add to map
            };
        /**
         * Drawin point on the map as pins
         * @Incjet createPopups()
         * @param  features
         */
        /**
         * Drawin point on the map as pins
         * \@Incjet createPopups()
         * @param {?} features
         * @return {?}
         */
        AtlasMapComponent.prototype.createPoints = /**
         * Drawin point on the map as pins
         * \@Incjet createPopups()
         * @param {?} features
         * @return {?}
         */
            function (features) {
                var e_1, _a;
                if (features.length === 0) {
                    console.log('No data available');
                    return;
                }
                try {
                    for (var features_1 = __values(features), features_1_1 = features_1.next(); !features_1_1.done; features_1_1 = features_1.next()) {
                        var item = features_1_1.value;
                        this.map.addPins([item.atlasFeature], item.pinConfig);
                        if (item.atlasFeature.properties.cssClass) {
                            this.addItem(item.dataElement.id, item.dataElement.localization, item.atlasFeature.properties.cssClass);
                            this.customPins.push(item.atlasFeature.properties.cssClass);
                        }
                        this.pointsArray.push(item.atlasFeature);
                    }
                }
                catch (e_1_1) {
                    e_1 = { error: e_1_1 };
                }
                finally {
                    try {
                        if (features_1_1 && !features_1_1.done && (_a = features_1.return))
                            _a.call(features_1);
                    }
                    finally {
                        if (e_1)
                            throw e_1.error;
                    }
                }
                this.createPopups(features);
            };
        /**
         * Created popUps for all features by type of layers
         * Adding event on 'mouseover'
         * @param features
         */
        /**
         * Created popUps for all features by type of layers
         * Adding event on 'mouseover'
         * @param {?} features
         * @return {?}
         */
        AtlasMapComponent.prototype.createPopups = /**
         * Created popUps for all features by type of layers
         * Adding event on 'mouseover'
         * @param {?} features
         * @return {?}
         */
            function (features) {
                var _this = this;
                var e_2, _a;
                try {
                    for (var _b = __values(this.findUniqueLayers(features)), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var item = _c.value;
                        if (this.popupTemplate) {
                            this.map.addEventListener('mouseover', item, function (e) {
                                /** @type {?} */
                                var amFeature = features.find(function (it) { return it.dataElement.name === e.features[0].properties.name; });
                                _this.createComponent({
                                    /**
                                                 * sent to template variable
                                                 * raw data from input
                                                 */
                                    dataElement: amFeature.dataElement
                                });
                                _this.popupAtlas.setPopupOptions({
                                    position: e.features[0].geometry.coordinates,
                                    content: document.getElementById("popupWrapper"),
                                });
                                _this.popupAtlas.open(_this.map);
                            });
                        }
                    }
                }
                catch (e_2_1) {
                    e_2 = { error: e_2_1 };
                }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return))
                            _a.call(_b);
                    }
                    finally {
                        if (e_2)
                            throw e_2.error;
                    }
                }
            };
        /**
         * @param {?} features
         * @return {?}
         */
        AtlasMapComponent.prototype.updatePoints = /**
         * @param {?} features
         * @return {?}
         */
            function (features) {
                var _this = this;
                this.map.removeLayers(this.findUniqueLayers(features));
                if (this.cssArray.length) {
                    this.cssArray.forEach(function (value) {
                        ( /** @type {?} */(document.querySelectorAll("#" + value))).forEach(function (it) { return it.remove(); });
                        _this.map.removeHtml(value);
                    });
                    this.cssArray = [];
                }
                this.createPoints(features);
            };
        /**
         * @return {?}
         */
        AtlasMapComponent.prototype.removeMap = /**
         * @return {?}
         */
            function () {
                this.map.remove();
            };
        AtlasMapComponent.decorators = [
            { type: core.Component, args: [{
                        selector: 'am-map',
                        template: "<div #mapWrapper class=\"atlas-map\"></div>\n\n<div id=\"popupWrapper\">\n  <div #popupsContainer>\n  </div>\n</div>\n\n\n\n\n",
                        styles: [".atlas-map{position:relative;width:100%;height:100%}"]
                    },] },
        ];
        /** @nocollapse */
        AtlasMapComponent.ctorParameters = function () {
            return [
                { type: LoadMapService }
            ];
        };
        AtlasMapComponent.propDecorators = {
            initialConfig: [{ type: core.Input }],
            _id: [{ type: core.Input }],
            onMapClick: [{ type: core.Output }],
            loaded: [{ type: core.Output }],
            popupsContainer: [{ type: core.ViewChild, args: ['popupsContainer', { read: core.ViewContainerRef },] }],
            mapWrapper: [{ type: core.ViewChild, args: ['mapWrapper', { read: core.ElementRef },] }],
            popupTemplate: [{ type: core.ContentChild, args: [AtlasPopupDirective, { read: core.TemplateRef },] }]
        };
        return AtlasMapComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */
    var AmModule = /** @class */ (function () {
        function AmModule() {
        }
        /**
         * @return {?}
         */
        AmModule.forRoot = /**
         * @return {?}
         */
            function () {
                return {
                    ngModule: AmModule,
                    providers: [
                        LoadMapService
                    ]
                };
            };
        AmModule.decorators = [
            { type: core.NgModule, args: [{
                        imports: [
                            common.CommonModule,
                        ],
                        declarations: [AtlasMapComponent, AtlasPopupDirective],
                        exports: [
                            AtlasMapComponent,
                            AtlasPopupDirective,
                        ],
                        bootstrap: [AtlasMapComponent]
                    },] },
        ];
        return AmModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
     */

    exports.AmModule = AmModule;
    exports.AtlasMapComponent = AtlasMapComponent;
    exports.LoadMapService = LoadMapService;
    exports.ɵa = AtlasPopupDirective;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNhaXNvZnQtYW5ndWxhci1henVyZS1tYXBzLnVtZC5qcy5tYXAiLCJzb3VyY2VzIjpbbnVsbCwibmc6Ly9AYWNhaXNvZnQvYW5ndWxhci1henVyZS1tYXBzL3NyYy9henVyZS1tYXAvZGlyZWN0aXZlcy9hdGxhcy1wb3B1cC5kaXJlY3RpdmUudHMiLCJuZzovL0BhY2Fpc29mdC9hbmd1bGFyLWF6dXJlLW1hcHMvc3JjL2F6dXJlLW1hcC91dGlscy9henVyZS1tYXAtbGF6eS1sb2FkZXIudHMiLCJuZzovL0BhY2Fpc29mdC9hbmd1bGFyLWF6dXJlLW1hcHMvc3JjL2F6dXJlLW1hcC91dGlscy9sb2FkLW1hcC5zZXJ2aWNlLnRzIiwibmc6Ly9AYWNhaXNvZnQvYW5ndWxhci1henVyZS1tYXBzL3NyYy9henVyZS1tYXAvYXRsYXMtbWFwL2F0bGFzLW1hcC5jb21wb25lbnQudHMiLCJuZzovL0BhY2Fpc29mdC9hbmd1bGFyLWF6dXJlLW1hcHMvc3JjL2F6dXJlLW1hcC9hbS5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIGlmIChlLmluZGV4T2YocFtpXSkgPCAwKVxyXG4gICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIGV4cG9ydHMpIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCJpbXBvcnQgeyBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2FtUG9wdXBdJ1xufSlcbmV4cG9ydCBjbGFzcyBBdGxhc1BvcHVwRGlyZWN0aXZlIHtcblxuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG5cbn1cbiIsImludGVyZmFjZSBTb3VyY2Uge1xuICB0eXBlOiBBc3NldFR5cGU7XG4gIHNyYzogc3RyaW5nO1xufVxuXG5jb25zdCBzb3VyY2VzOiBTb3VyY2VbXSA9IFtcbiAgICB7XG4gICAgICAgIHR5cGU6ICdzdHlsZScsXG4gICAgICAgIHNyYzogJ2h0dHBzOi8vYXRsYXMubWljcm9zb2Z0LmNvbS9zZGsvY3NzL2F0bGFzLm1pbi5jc3M/YXBpLXZlcnNpb249MSdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ3NjcmlwdCcsXG4gICAgICAgIHNyYzogJ2h0dHBzOi8vYXRsYXMubWljcm9zb2Z0LmNvbS9zZGsvanMvYXRsYXMubWluLmpzP2FwaS12ZXJzaW9uPTEnXG4gICAgfVxuXTtcblxuZXhwb3J0IGZ1bmN0aW9uIF93aW5kb3coKTogYW55IHtcbiAgICByZXR1cm4gd2luZG93O1xufVxuXG5leHBvcnQgdHlwZSBBc3NldFR5cGUgPSAnc2NyaXB0JyB8ICdzdHlsZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkU2luZ2xlQXNzZXQoc291cmNlOiBzdHJpbmcsIHR5cGU6IEFzc2V0VHlwZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBjcmVhdGVkRWxlbWVudDtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdzY3JpcHQnOlxuICAgICAgICAgICAgICAgIGNyZWF0ZWRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgICAgICAgICAgY3JlYXRlZEVsZW1lbnQuc3JjID0gc291cmNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3R5bGUnOlxuICAgICAgICAgICAgICAgIGNyZWF0ZWRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO1xuICAgICAgICAgICAgICAgIGNyZWF0ZWRFbGVtZW50LnJlbCA9ICdzdHlsZXNoZWV0JztcbiAgICAgICAgICAgICAgICBjcmVhdGVkRWxlbWVudC5ocmVmID0gc291cmNlO1xuICAgICAgICAgICAgICAgIGNyZWF0ZWRFbGVtZW50LnR5cGUgPSAndGV4dC9jc3MnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZWplY3QoJ1dyb25nIFR5cGUnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIChfd2luZG93KCkuYXRsYXMpICE9PSAndW5kZWZpbmVkJ1xuICAgICAgICAgICAgJiYgdHlwZW9mIChfd2luZG93KCkuYXRsYXMuTWFwKSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjcmVhdGVkRWxlbWVudC5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgIGNyZWF0ZWRFbGVtZW50Lm9ubG9hZCA9IHJlc29sdmU7XG4gICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChjcmVhdGVkRWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXp1cmVNYXBMYXp5TG9hZGVyKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChzb3VyY2VzLm1hcChzb3VyY2UgPT4gbG9hZFNpbmdsZUFzc2V0KHNvdXJjZS5zcmMsIHNvdXJjZS50eXBlKSkpO1xufVxuIiwiaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7YXp1cmVNYXBMYXp5TG9hZGVyfSBmcm9tICcuL2F6dXJlLW1hcC1sYXp5LWxvYWRlcic7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtmcm9tUHJvbWlzZX0gZnJvbSAncnhqcy9pbnRlcm5hbC1jb21wYXRpYmlsaXR5JztcbmltcG9ydCB7Yn0gZnJvbSAnQGFuZ3VsYXIvY29yZS9zcmMvcmVuZGVyMyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBMb2FkTWFwU2VydmljZSB7XG5cblxuICBwdWJsaWMgaXNMb2FkZWQgPSBmYWxzZTtcblxuICBwdWJsaWMgaXNDb21wb25lbnRMb2FkZWQgPSBmYWxzZVxuXG5cblxuICBsb2FkZWRTdWJqZWN0ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgbG9hZGVkQ29tcG9uZW5ldCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cblxuXG4gIGxvYWQoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmlzTG9hZGVkKSB7XG4gICAgICByZXR1cm4gZnJvbVByb21pc2UoYXp1cmVNYXBMYXp5TG9hZGVyKCkudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMuaXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcy5pc0xvYWRlZDtcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIG9ic2VydmFibGVDb21wb25lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubG9hZGVkU3ViamVjdC5hc09ic2VydmFibGUoKTtcbiAgfVxufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL2F0bGFzXCIvPlxuXG5pbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgRW1iZWRkZWRWaWV3UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0FtRmVhdHVyZX0gZnJvbSAnLi4vaW50ZXJmYWNlcy9hbS1mZWF0dXJlJztcbmltcG9ydCB7QXRsYXNQb3B1cERpcmVjdGl2ZX0gZnJvbSAnLi4vZGlyZWN0aXZlcy9hdGxhcy1wb3B1cC5kaXJlY3RpdmUnO1xuaW1wb3J0IHtMb2FkTWFwU2VydmljZX0gZnJvbSAnLi4vdXRpbHMvbG9hZC1tYXAuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FtLW1hcCcsXG4gIHRlbXBsYXRlOiBgPGRpdiAjbWFwV3JhcHBlciBjbGFzcz1cImF0bGFzLW1hcFwiPjwvZGl2PlxuXG48ZGl2IGlkPVwicG9wdXBXcmFwcGVyXCI+XG4gIDxkaXYgI3BvcHVwc0NvbnRhaW5lcj5cbiAgPC9kaXY+XG48L2Rpdj5cblxuXG5cblxuYCxcbiAgc3R5bGVzOiBbYC5hdGxhcy1tYXB7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJX1gXVxufSlcbmV4cG9ydCBjbGFzcyBBdGxhc01hcENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBJbnB1dCgpIGluaXRpYWxDb25maWc6IGFueTtcbiAgQElucHV0KCkgX2lkOiBzdHJpbmc7XG5cblxuICBAT3V0cHV0KCkgb25NYXBDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8YXRsYXMuZGF0YS5Qb3NpdGlvbj4oKTtcbiAgQE91dHB1dCgpIGxvYWRlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQFZpZXdDaGlsZCgncG9wdXBzQ29udGFpbmVyJywge3JlYWQ6IFZpZXdDb250YWluZXJSZWZ9KSBwb3B1cHNDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG4gIEBWaWV3Q2hpbGQoJ21hcFdyYXBwZXInLCB7cmVhZDogRWxlbWVudFJlZn0pIG1hcFdyYXBwZXI6IEVsZW1lbnRSZWY7XG5cbiAgLyoqXG4gICAqIEZvciBjcmVhdGUgYW5kIGNvbnRyb2wgcG9wdXBcbiAgICogVG8gSW5qZWN0IGludG8gbmctdGVtcGxhdGUgaW4gcGFyZW50XG4gICAqL1xuICBAQ29udGVudENoaWxkKEF0bGFzUG9wdXBEaXJlY3RpdmUsIHtyZWFkOiBUZW1wbGF0ZVJlZn0pIHBvcHVwVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgcHVibGljIHBvcHVwVmlldzogRW1iZWRkZWRWaWV3UmVmPGFueT47XG4gIHB1YmxpYyBwb3B1cEF0bGFzOiBhdGxhcy5Qb3B1cDtcblxuICBwdWJsaWMgbWFwOiBhdGxhcy5NYXA7XG4gIHByaXZhdGUgY3VzdG9tUGluczogQXJyYXk8YW55PiA9IFtdO1xuICBwdWJsaWMgZmVhdHVyZXM6IEFtRmVhdHVyZVtdID0gW107IC8vIEFycmF5IG9mIG91cnMgcG9pbnRzIHRvIGFkZCBvbiBtYXBcbiAgcHJpdmF0ZSBwb2ludHNBcnJheTogYXRsYXMuZGF0YS5GZWF0dXJlW10gPSBbXTtcbiAgcHJpdmF0ZSBjc3NBcnJheTogc3RyaW5nW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1hcFNlcnZpY2U6IExvYWRNYXBTZXJ2aWNlKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnBvcHVwQXRsYXMgPSBuZXcgYXRsYXMuUG9wdXAoKTtcbiAgICB0aGlzLm1hcFNlcnZpY2UubG9hZGVkQ29tcG9uZW5ldC5uZXh0KHRydWUpO1xuXG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jcmVhdGVNYXAodGhpcy5faWQsIHRoaXMuaW5pdGlhbENvbmZpZyk7IC8vIEluaXRpYWwgbWFwXG4gICAgdGhpcy5zdGFydE1hcENsaWNrTGlzdGVuZXIoKTsgLy8gU3RhcnQgZW1pdHRlclxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZW1pdExvYWRlZCgpO1xuICB9XG5cbiAgZW1pdExvYWRlZCgpIHtcbiAgICBpZiAodGhpcy5tYXApIHtcbiAgICAgIHRoaXMubG9hZGVkLmVtaXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0VGltZW91dCh0aGlzLmVtaXRMb2FkZWQsIDEwMCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNyZWF0ZU1hcChpZDogc3RyaW5nLCBjb25maWc6IGFueSk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLm1hcFdyYXBwZXIubmF0aXZlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpO1xuICAgICAgdGhpcy5tYXAgPSBuZXcgYXRsYXMuTWFwKGlkLCBjb25maWcpOyAvLyBJbml0IG1hcCBib3hcbiAgICAgIGNvbnNvbGUubG9nKCdNYXAgd2FzIGNyZWF0ZWQhJywgdGhpcy5tYXApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdDSEVDSyBZT1VSIENPTkZJRyEnLCBlKTtcbiAgICB9XG4gIH1cblxuICBjaGFuZ2VNYXBDYW1lcmEob3B0aW9uczogQ2FtZXJhT3B0aW9ucyAmIEFuaW1hdGlvbk9wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLm1hcC5zZXRDYW1lcmEob3B0aW9ucyk7XG4gIH1cblxuICBjaGFuZ2VNYXBTdHlsZShvcHRpb25zOiBTdHlsZU9wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLm1hcC5zZXRTdHlsZShvcHRpb25zKTtcbiAgfVxuXG4gIGNoYW5nZVVzZXJJbnRlcmFjdGlvbihvcHRpb25zOiBVc2VySW50ZXJhY3Rpb25PcHRpb25zKTogdm9pZCB7XG4gICAgdGhpcy5tYXAuc2V0VXNlckludGVyYWN0aW9uKG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvdW5kaW5nIGFsbCB1bmlxdWUgbGF5ZXJzIGZyb20gZmVhdHVyZXMgQXJyYXlcbiAgICogQHBhcmFtIEFtRmVhdHVyZVtdIGZlYXR1cmVzXG4gICAqIEByZXR1cm5zIHN0cmluZ1tdXG4gICAqL1xuICBmaW5kVW5pcXVlTGF5ZXJzKGZlYXR1cmVzOiBBbUZlYXR1cmVbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBhbGxMYXllcnMgPSBmZWF0dXJlcy5tYXAoaXQgPT4gaXQubGF5ZXIpO1xuICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoYWxsTGF5ZXJzKSk7XG4gIH1cblxuICBzdGFydE1hcENsaWNrTGlzdGVuZXIoKTogdm9pZCB7XG4gICAgdGhpcy5tYXAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgdGhpcy5vbk1hcENsaWNrLmVtaXQoZS5wb3NpdGlvbik7XG4gICAgICAvLyBPbiBjbGljayB5b3UgZW1pdCBnZW8gcG9zaXRpb25cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGluZyBwb3BVcENvbnRhaW5lciBhbmQgaW5qZWN0ZWQgdG8gcGFyZW50IFRlbXBsYXRlXG4gICAqIEBwYXJhbSBjb250ZXh0XG4gICAqL1xuICBjcmVhdGVDb21wb25lbnQoY29udGV4dDogYW55KTogdm9pZCB7XG4gICAgaWYgKHRoaXMucG9wdXBWaWV3KSB7XG4gICAgICB0aGlzLnBvcHVwVmlldy5kZXN0cm95KCk7XG4gICAgfVxuICAgIHRoaXMucG9wdXBWaWV3ID0gdGhpcy5wb3B1cHNDb250YWluZXIuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMucG9wdXBUZW1wbGF0ZSwgY29udGV4dCk7XG4gIH1cblxuICBhZGRJdGVtKGlkLCBsb2MsIGNsYXMpOiB2b2lkIHtcbiAgICBsZXQgY3VzdG9tSFRNTDtcbiAgICBjb25zdCBpZEl0ZW0gPSBjbGFzICsgaWQ7XG4gICAgY29uc3QgcG9zID0gbmV3IGF0bGFzLmRhdGEuUG9zaXRpb24obG9jLmxudCwgbG9jLmxuZyk7XG4gICAgdGhpcy5jc3NBcnJheS5wdXNoKGlkSXRlbSk7ICAvLyBTYXZpbmcgZXhpc3RpbmcgSFRNTCBlbGVtZW50c1xuXG4gICAgY3VzdG9tSFRNTCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGN1c3RvbUhUTUwuc2V0QXR0cmlidXRlKCdpZCcsIGlkSXRlbSk7XG4gICAgY3VzdG9tSFRNTC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgY2xhcyk7XG5cbiAgICB0aGlzLm1hcC5hZGRIdG1sKGN1c3RvbUhUTUwsIHBvcyk7IC8vIGFkZCB0byBtYXBcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3aW4gcG9pbnQgb24gdGhlIG1hcCBhcyBwaW5zXG4gICAqIEBJbmNqZXQgY3JlYXRlUG9wdXBzKClcbiAgICogQHBhcmFtICBmZWF0dXJlc1xuICAgKi9cbiAgY3JlYXRlUG9pbnRzKGZlYXR1cmVzOiBBbUZlYXR1cmVbXSk6IHZvaWQge1xuICAgIGlmIChmZWF0dXJlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdObyBkYXRhIGF2YWlsYWJsZScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBmZWF0dXJlcykge1xuICAgICAgdGhpcy5tYXAuYWRkUGlucyhbaXRlbS5hdGxhc0ZlYXR1cmVdLCBpdGVtLnBpbkNvbmZpZyk7XG4gICAgICBpZiAoaXRlbS5hdGxhc0ZlYXR1cmUucHJvcGVydGllcy5jc3NDbGFzcykge1xuICAgICAgICB0aGlzLmFkZEl0ZW0oaXRlbS5kYXRhRWxlbWVudC5pZCwgaXRlbS5kYXRhRWxlbWVudC5sb2NhbGl6YXRpb24sIGl0ZW0uYXRsYXNGZWF0dXJlLnByb3BlcnRpZXMuY3NzQ2xhc3MpO1xuICAgICAgICB0aGlzLmN1c3RvbVBpbnMucHVzaChpdGVtLmF0bGFzRmVhdHVyZS5wcm9wZXJ0aWVzLmNzc0NsYXNzKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucG9pbnRzQXJyYXkucHVzaChpdGVtLmF0bGFzRmVhdHVyZSk7XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlUG9wdXBzKGZlYXR1cmVzKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIENyZWF0ZWQgcG9wVXBzIGZvciBhbGwgZmVhdHVyZXMgYnkgdHlwZSBvZiBsYXllcnNcbiAgICogQWRkaW5nIGV2ZW50IG9uICdtb3VzZW92ZXInXG4gICAqIEBwYXJhbSBmZWF0dXJlc1xuICAgKi9cbiAgY3JlYXRlUG9wdXBzKGZlYXR1cmVzOiBBbUZlYXR1cmVbXSk6IHZvaWQge1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmZpbmRVbmlxdWVMYXllcnMoZmVhdHVyZXMpKSB7XG4gICAgICBpZiAodGhpcy5wb3B1cFRlbXBsYXRlKSB7XG4gICAgICAgIHRoaXMubWFwLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIGl0ZW0sIChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYW1GZWF0dXJlOiBBbUZlYXR1cmUgPSBmZWF0dXJlcy5maW5kKGl0ID0+IGl0LmRhdGFFbGVtZW50Lm5hbWUgPT09IGUuZmVhdHVyZXNbMF0ucHJvcGVydGllcy5uYW1lKTtcbiAgICAgICAgICB0aGlzLmNyZWF0ZUNvbXBvbmVudCh7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIHNlbnQgdG8gdGVtcGxhdGUgdmFyaWFibGVcbiAgICAgICAgICAgICAqIHJhdyBkYXRhIGZyb20gaW5wdXRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZGF0YUVsZW1lbnQ6IGFtRmVhdHVyZS5kYXRhRWxlbWVudFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMucG9wdXBBdGxhcy5zZXRQb3B1cE9wdGlvbnMoe1xuICAgICAgICAgICAgcG9zaXRpb246IGUuZmVhdHVyZXNbMF0uZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG4gICAgICAgICAgICBjb250ZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcG9wdXBXcmFwcGVyYCksXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5wb3B1cEF0bGFzLm9wZW4odGhpcy5tYXApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVQb2ludHMoZmVhdHVyZXM6IEFtRmVhdHVyZVtdKTogdm9pZCB7XG4gICAgdGhpcy5tYXAucmVtb3ZlTGF5ZXJzKHRoaXMuZmluZFVuaXF1ZUxheWVycyhmZWF0dXJlcykpO1xuICAgIGlmICh0aGlzLmNzc0FycmF5Lmxlbmd0aCkge1xuICAgICAgdGhpcy5jc3NBcnJheS5mb3JFYWNoKHZhbHVlID0+IHtcbiAgICAgICAgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYCMke3ZhbHVlfWApIGFzIGFueSkuZm9yRWFjaChpdCA9PiBpdC5yZW1vdmUoKSk7XG4gICAgICAgIHRoaXMubWFwLnJlbW92ZUh0bWwodmFsdWUpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNzc0FycmF5ID0gW107XG4gICAgfVxuICAgIHRoaXMuY3JlYXRlUG9pbnRzKGZlYXR1cmVzKTtcbiAgfVxuXG4gIHJlbW92ZU1hcCgpIHtcbiAgICB0aGlzLm1hcC5yZW1vdmUoKTtcbiAgfVxuXG5cbn1cblxuXG5cbiIsImltcG9ydCB7TW9kdWxlV2l0aFByb3ZpZGVycywgTmdNb2R1bGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEF0bGFzTWFwQ29tcG9uZW50IH0gZnJvbSAnLi9hdGxhcy1tYXAvYXRsYXMtbWFwLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBBdGxhc1BvcHVwRGlyZWN0aXZlIH0gZnJvbSAnLi9kaXJlY3RpdmVzL2F0bGFzLXBvcHVwLmRpcmVjdGl2ZSc7XG5pbXBvcnQge0xvYWRNYXBTZXJ2aWNlfSBmcm9tICcuL3V0aWxzL2xvYWQtbWFwLnNlcnZpY2UnO1xuaW1wb3J0IHtCcm93c2VyTW9kdWxlfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcblxuQE5nTW9kdWxlKHtcbiAgaW1wb3J0czogW1xuICAgIENvbW1vbk1vZHVsZSxcbiAgXSxcbiAgZGVjbGFyYXRpb25zOiBbQXRsYXNNYXBDb21wb25lbnQsIEF0bGFzUG9wdXBEaXJlY3RpdmVdLFxuICBleHBvcnRzOiBbXG4gICAgQXRsYXNNYXBDb21wb25lbnQsXG4gICAgQXRsYXNQb3B1cERpcmVjdGl2ZSxcbiAgXSxcbiAgYm9vdHN0cmFwOiBbQXRsYXNNYXBDb21wb25lbnRdXG59KVxuZXhwb3J0IGNsYXNzIEFtTW9kdWxlIHtcbiAgcHVibGljIHN0YXRpYyBmb3JSb290KCk6IE1vZHVsZVdpdGhQcm92aWRlcnMge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5nTW9kdWxlOiBBbU1vZHVsZSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBMb2FkTWFwU2VydmljZVxuICAgICAgXVxuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJEaXJlY3RpdmUiLCJTdWJqZWN0IiwiQmVoYXZpb3JTdWJqZWN0IiwiZnJvbVByb21pc2UiLCJvZiIsIkluamVjdGFibGUiLCJFdmVudEVtaXR0ZXIiLCJ0c2xpYl8xLl9fdmFsdWVzIiwiQ29tcG9uZW50IiwiSW5wdXQiLCJPdXRwdXQiLCJWaWV3Q2hpbGQiLCJWaWV3Q29udGFpbmVyUmVmIiwiRWxlbWVudFJlZiIsIkNvbnRlbnRDaGlsZCIsIlRlbXBsYXRlUmVmIiwiTmdNb2R1bGUiLCJDb21tb25Nb2R1bGUiXSwibWFwcGluZ3MiOiI7Ozs7OztJQUFBOzs7Ozs7Ozs7Ozs7OztBQWNBLHNCQTRGeUIsQ0FBQztRQUN0QixJQUFJLENBQUMsR0FBRyxPQUFPLE1BQU0sS0FBSyxVQUFVLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FB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