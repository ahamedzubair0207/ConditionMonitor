!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@flosportsinc/ng-fullscreen",["exports","@angular/core","@angular/common","rxjs","rxjs/operators"],t):t(((e=e||self).flosportsinc=e.flosportsinc||{},e.flosportsinc["ng-fullscreen"]={}),e.ng.core,e.ng.common,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,r,o){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var u=function(){return"undefined"!=typeof window&&void 0!==window.navigator&&!!window.navigator.userAgent.match(/iPhone/)},a=new t.InjectionToken("fs.fullscreen.request"),f=new t.InjectionToken("fs.fullscreen.exit"),p=new t.InjectionToken("fs.fullscreen.change"),d=new t.InjectionToken("fs.fullscreen.error"),E=new t.InjectionToken("fs.fullscreen.element"),y=new t.InjectionToken("fs.fullscreen.enabled"),h=new t.InjectionToken("fs.fullscreen.enabled-func"),F=new t.InjectionToken("fs.fullscreen.ios.poll.enabled"),m=new t.InjectionToken("fs.fullscreen.ios.poll.ms"),g=function(e){return function(t){return e.reduce(function(e,n){return!(!e&&!t[n])},!1)}},S=function(e){return function(t){return r.merge.apply(void 0,c(e.map(function(e){return r.fromEvent(t,e)}))).pipe(o.debounceTime(0))}},v=function(e){return function(t){var n=t.findIndex(function(t){return"function"==typeof e[t]});n>=0&&e[t[n]]()}},_=function(){function e(e,t,i,s,l,a,f,p,d,E,y,h){var F=this;this.zone=e,this.doc=t,this.platformId=i,this.requestEventKeys=s,this.exitEventKeys=l,this.elementKeys=a,this.changeEventKeys=f,this.elementErrorEventKeys=p,this.enabledKeys=d,this.enabledFunc=E,this.iosPollrate=y,this.iosPollEnabled=h,this.iOSVideoState=new r.BehaviorSubject(!1),this.isFullscreen=function(e){return void 0===e&&(e=F.doc),!n.isPlatformServer(F.platformId)&&(g(F.elementKeys)(e)||F.iOSVideoState.getValue())},this.fullscreenError$=S(this.elementErrorEventKeys)(this.doc).pipe(o.map(function(e){return r.throwError(e)})),this.iosVideoBypass=function(e){return u()?["webkitEnterFullscreen"]:e},this.extractVideoForIphoneIfRequired=function(e){return!u()||e instanceof HTMLVideoElement?e:e.querySelector("video")||e},this.iosPoller=function(){return F.iosPollEnabled?F.zone.runOutsideAngular(function(){return r.interval(F.iosPollrate).pipe(o.map(function(){return Array.from(F.doc.querySelectorAll("video"))}),o.flatMap(function(e){return r.merge.apply(void 0,c(e.map(function(e){return r.fromEvent(e,"webkitbeginfullscreen").pipe(o.tap(function(){return F.iOSVideoState.next(!0)}),o.take(1))}),e.map(function(e){return r.fromEvent(e,"webkitendfullscreen").pipe(o.tap(function(){return F.iOSVideoState.next(!1)}),o.take(1))})))}),o.takeUntil(F.iOSVideoState))}):r.EMPTY},this.fullscreen$=n.isPlatformServer(this.platformId)?r.of(!1):r.merge.apply(void 0,c(this.changeEventKeys.map(function(e){return r.fromEvent(F.doc,e)}),[this.fullscreenError$,this.iosPoller()])).pipe(o.debounceTime(0),o.map(function(){return F.isFullscreen()}),o.distinctUntilChanged(),o.startWith(this.isFullscreen()),o.shareReplay(1)),this.fullscreenIsSupported=function(e){return(n.isPlatformServer(F.platformId)?r.of(!1):g(F.enabledKeys)(F.doc)?r.of(!0):e?F.enabledFunc(e):r.of(!1)).pipe(o.shareReplay(1))},this.canGoFullscreen=function(e){return(n.isPlatformServer(F.platformId)?r.of(!1):F.fullscreenIsSupported(e).pipe(o.flatMap(function(e){return e?F.fullscreen$.pipe(o.map(function(e){return!e})):r.of(!1)}))).pipe(o.shareReplay(1))},this.isFullscreen$=this.fullscreen$.pipe(o.filter(function(e){return!0===e})),this.isNotFullscreen=this.fullscreen$.pipe(o.filter(function(e){return!1===e})),this.exitFullscreen=function(){return v(F.doc)(F.exitEventKeys)},this.goFullscreen=function(e){return void 0===e&&(e=F.doc.body),v(e)(F.iosVideoBypass(F.requestEventKeys))}}return e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.NgZone},{type:void 0,decorators:[{type:t.Inject,args:[n.DOCUMENT]}]},{type:String,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:Array,decorators:[{type:t.Inject,args:[a]}]},{type:Array,decorators:[{type:t.Inject,args:[f]}]},{type:Array,decorators:[{type:t.Inject,args:[E]}]},{type:Array,decorators:[{type:t.Inject,args:[p]}]},{type:Array,decorators:[{type:t.Inject,args:[d]}]},{type:Array,decorators:[{type:t.Inject,args:[y]}]},{type:void 0,decorators:[{type:t.Inject,args:[h]}]},{type:Number,decorators:[{type:t.Inject,args:[m]}]},{type:Boolean,decorators:[{type:t.Inject,args:[F]}]}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(t.NgZone),t.inject(n.DOCUMENT),t.inject(t.PLATFORM_ID),t.inject(a),t.inject(f),t.inject(E),t.inject(p),t.inject(d),t.inject(y),t.inject(h),t.inject(m),t.inject(F))},token:e,providedIn:"root"}),e}(),L=["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],b=["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],I=["fullscreenerror","webkitfullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"],N=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],j=["fullscreenEnabled","mozFullscreenEnabled","webkitFullscreenEnabled","msFullscreenEnabled"],T=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"];function C(){return function(e){var t=e instanceof HTMLVideoElement?e:e.querySelector("video");return t?t.readyState>=2?r.of(!0):r.fromEvent(t,"loadedmetadata").pipe(o.map(function(e){return!!e.target&&e.target.webkitSupportsFullscreen}),o.take(1)):r.of(!1)}}var w=L,R=b,k=T,D=I,O=N,U=j,P=C,V=function(){function e(){}return e.config=function(t){return{ngModule:e,providers:[{provide:F,useValue:!t.ios||"boolean"!=typeof t.ios.enabled||t.ios.enabled},{provide:m,useValue:t.ios&&"number"==typeof t.ios.pollDurationMs?t.ios.pollDurationMs:60}]}},e.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule],exports:[n.CommonModule],providers:[_,{provide:a,useValue:w},{provide:f,useValue:R},{provide:p,useValue:k},{provide:d,useValue:D},{provide:E,useValue:O},{provide:y,useValue:U},{provide:h,useFactory:P},{provide:m,useValue:60},{provide:F,useValue:!0}]}]}],e}(),M=function(){function e(e,t,n){this.fs=e,this.doc=t,this.cd=n}return Object.defineProperty(e.prototype,"floClickToEnterFullscreen",{get:function(){return this._element},set:function(e){e instanceof HTMLElement?this._element=e:this._element=this.doc.body},enumerable:!0,configurable:!0}),e.prototype.click=function(){var e=this;this.cd.detectChanges(),this.fs.isNotFullscreen.pipe(o.take(1)).subscribe(function(t){e.fs.goFullscreen(e.fs.extractVideoForIphoneIfRequired(e.floClickToEnterFullscreen))})},e.decorators=[{type:t.Directive,args:[{selector:"[floClickToEnterFullscreen]"}]}],e.ctorParameters=function(){return[{type:_},{type:void 0,decorators:[{type:t.Inject,args:[n.DOCUMENT]}]},{type:t.ChangeDetectorRef}]},e.propDecorators={floClickToEnterFullscreen:[{type:t.Input}],click:[{type:t.HostListener,args:["click",[]]}]},e}(),x=function(){function e(e){this.fs=e}return e.prototype.click=function(){this.fs.exitFullscreen()},e.decorators=[{type:t.Directive,args:[{selector:"[floClickToExitFullscreen]"}]}],e.ctorParameters=function(){return[{type:_}]},e.propDecorators={click:[{type:t.HostListener,args:["click",[]]}]},e}(),A=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[V],declarations:[M,x],exports:[M,x]}]}],e}(),K=function(){function e(e,t,n,o,i,s,l){var c=this;this.tr=e,this.vc=t,this.fs=n,this.cd=o,this.iosPollEnabled=i,this.iosPollrate=s,this.zone=l,this.elmSource=new r.Subject,this.showWhenFullscreen=!1,this.ngOnDestroy$=new r.Subject,this.elm=function(){return c.elmInputKey?c[c.elmInputKey]:void 0},this.elm$=this.elmSource.asObservable()}return e.prototype.ngOnInit=function(){var e=this;r.combineLatest(this.fs.fullscreen$,this.elm$.pipe(o.tap(function(){return e.cd.detectChanges()}),o.startWith(this.elm()),o.delay(0),o.flatMap(function(t){return e.iosPollEnabled&&u()?e.zone.runOutsideAngular(function(){return r.interval(e.iosPollrate).pipe(o.flatMap(function(){return e.fs.fullscreenIsSupported(t)}),o.distinctUntilChanged(),o.takeUntil(e.ngOnDestroy$))}):e.fs.fullscreenIsSupported(t)}),o.takeUntil(this.ngOnDestroy$))).pipe(o.takeUntil(this.ngOnDestroy$)).subscribe(function(t){var n=t[0],r=t[1];e.vc.clear(),e.showWhenFullscreen?n&&e.vc.createEmbeddedView(e.tr):n||r&&e.vc.createEmbeddedView(e.tr),e.cd.detectChanges()})},e.prototype.ngOnChanges=function(e){this.elmInputKey&&e[this.elmInputKey]&&this.elmSource.next(e[this.elmInputKey].currentValue)},e.prototype.ngOnDestroy=function(){this.ngOnDestroy$.next(),this.ngOnDestroy$.complete()},e.ctorParameters=function(){return[{type:t.TemplateRef},{type:t.ViewContainerRef},{type:_},{type:t.ChangeDetectorRef},{type:Boolean,decorators:[{type:t.Inject,args:[F]}]},{type:Number,decorators:[{type:t.Inject,args:[m]}]},{type:t.NgZone}]},e}(),q="floIfFullscreen",$=function(e){function n(t,n,r,o,i,s,l){var c=e.call(this,t,n,r,o,i,s,l)||this;return c.tr=t,c.vc=n,c.fs=r,c.cd=o,c.iosPollEnabled=i,c.iosPollrate=s,c.zone=l,c.elmInputKey=q,c.showWhenFullscreen=!0,c}return s(n,e),n.decorators=[{type:t.Directive,args:[{selector:"["+q+"]",inputs:[q]}]}],n.ctorParameters=function(){return[{type:t.TemplateRef},{type:t.ViewContainerRef},{type:_},{type:t.ChangeDetectorRef},{type:Boolean,decorators:[{type:t.Inject,args:[F]}]},{type:Number,decorators:[{type:t.Inject,args:[m]}]},{type:t.NgZone}]},n}(K),B="floIfNotFullscreen",z=function(e){function n(t,n,r,o,i,s,l){var c=e.call(this,t,n,r,o,i,s,l)||this;return c.tr=t,c.vc=n,c.fs=r,c.cd=o,c.iosPollEnabled=i,c.iosPollrate=s,c.zone=l,c.elmInputKey=B,c.showWhenFullscreen=!1,c}return s(n,e),n.decorators=[{type:t.Directive,args:[{selector:"["+B+"]",inputs:[B]}]}],n.ctorParameters=function(){return[{type:t.TemplateRef},{type:t.ViewContainerRef},{type:_},{type:t.ChangeDetectorRef},{type:Boolean,decorators:[{type:t.Inject,args:[F]}]},{type:Number,decorators:[{type:t.Inject,args:[m]}]},{type:t.NgZone}]},n}(K),H=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[V],declarations:[$,z],exports:[$,z]}]}],e}(),W=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[V,H,A],exports:[V,H,A]}]}],e}();e.DEFAULT_FS_FULLSCREEN_CHANGE_EVENTS=T,e.DEFAULT_FS_FULLSCREEN_ELEMENT=N,e.DEFAULT_FS_FULLSCREEN_ELEMENT_ERROR_EVENTS=I,e.DEFAULT_FS_FULLSCREEN_ENABLED=j,e.DEFAULT_FS_FULLSCREEN_ENABLED_FUNC=C,e.DEFAULT_FS_FULLSCREEN_EXIT_EVENTS=b,e.DEFAULT_FS_FULLSCREEN_IOS_POLL_ENABLED=!0,e.DEFAULT_FS_FULLSCREEN_IOS_POLL_MS=60,e.DEFAULT_FS_FULLSCREEN_REQUEST_EVENTS=L,e.FS_FULLSCREEN_CHANGE_EVENTS=p,e.FS_FULLSCREEN_ELEMENT=E,e.FS_FULLSCREEN_ELEMENT_ERROR_EVENTS=d,e.FS_FULLSCREEN_ENABLED=y,e.FS_FULLSCREEN_ENABLED_FUNC=h,e.FS_FULLSCREEN_EXIT_EVENTS=f,e.FS_FULLSCREEN_IOS_POLL_ENABLED=F,e.FS_FULLSCREEN_IOS_POLL_MS=m,e.FS_FULLSCREEN_REQUEST_EVENTS=a,e.FloClickToEnterFullscreenDirective=M,e.FloClickToExitFullscreenDirective=x,e.FloFullscreenCommonModule=V,e.FloFullscreenDirective=K,e.FloFullscreenModule=W,e.FloFullscreenOffDirective=z,e.FloFullscreenOnDirective=$,e.FloFullscreenService=_,e.FloFullscreenSwitchModule=H,e.FloFullscreenToggleModule=A,e.isIphone=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=flosportsinc-ng-fullscreen.umd.min.js.map