/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, TemplateRef, ViewContainerRef, ChangeDetectorRef, Inject, NgZone } from '@angular/core';
import { takeUntil, flatMap, startWith, delay, tap, distinctUntilChanged } from 'rxjs/operators';
import { Subject, combineLatest, interval } from 'rxjs';
import { FloFullscreenService } from '../common/ng-fullscreen.service';
import { isIphone } from '../common/util';
import { FS_FULLSCREEN_IOS_POLL_MS, FS_FULLSCREEN_IOS_POLL_ENABLED } from '../common/ng-fullscreen.tokens';
// tslint:disable: readonly-keyword
/**
 * @abstract
 */
export class FloFullscreenDirective {
    /**
     * @param {?} tr
     * @param {?} vc
     * @param {?} fs
     * @param {?} cd
     * @param {?} iosPollEnabled
     * @param {?} iosPollrate
     * @param {?} zone
     */
    constructor(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        this.tr = tr;
        this.vc = vc;
        this.fs = fs;
        this.cd = cd;
        this.iosPollEnabled = iosPollEnabled;
        this.iosPollrate = iosPollrate;
        this.zone = zone;
        this.elmSource = new Subject();
        this.showWhenFullscreen = false;
        this.ngOnDestroy$ = new Subject();
        this.elm = (/**
         * @return {?}
         */
        () => this.elmInputKey ? (/** @type {?} */ (this[this.elmInputKey])) : undefined);
        this.elm$ = this.elmSource.asObservable();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        combineLatest(this.fs.fullscreen$, this.elm$.pipe(tap((/**
         * @return {?}
         */
        () => this.cd.detectChanges())), startWith(this.elm()), delay(0), flatMap((/**
         * @param {?} elm
         * @return {?}
         */
        elm => this.iosPollEnabled && isIphone()
            ? this.zone.runOutsideAngular((/**
             * @return {?}
             */
            () => interval(this.iosPollrate).pipe(flatMap((/**
             * @return {?}
             */
            () => this.fs.fullscreenIsSupported(elm))), distinctUntilChanged(), takeUntil(this.ngOnDestroy$))))
            : this.fs.fullscreenIsSupported(elm))), takeUntil(this.ngOnDestroy$))).pipe(takeUntil(this.ngOnDestroy$)).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            /** @type {?} */
            const isFullscreen = res[0];
            /** @type {?} */
            const isSupported = res[1];
            this.vc.clear();
            if (this.showWhenFullscreen) { // exit
                if (isFullscreen) {
                    this.vc.createEmbeddedView(this.tr);
                }
            }
            else if (!isFullscreen) { // enter
                if (isSupported) {
                    this.vc.createEmbeddedView(this.tr);
                }
            }
            this.cd.detectChanges();
        }));
    }
    /**
     * @param {?} sc
     * @return {?}
     */
    ngOnChanges(sc) {
        if (this.elmInputKey && sc[this.elmInputKey]) {
            this.elmSource.next(sc[this.elmInputKey].currentValue);
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.ngOnDestroy$.next();
        this.ngOnDestroy$.complete();
    }
}
/** @nocollapse */
FloFullscreenDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: FloFullscreenService },
    { type: ChangeDetectorRef },
    { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
    { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
    { type: NgZone }
];
if (false) {
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenDirective.prototype.elmSource;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.showWhenFullscreen;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.ngOnDestroy$;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elm;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elm$;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.zone;
}
/** @type {?} */
const IF_FS_SELECTOR = 'floIfFullscreen';
export class FloFullscreenOnDirective extends FloFullscreenDirective {
    /**
     * @param {?} tr
     * @param {?} vc
     * @param {?} fs
     * @param {?} cd
     * @param {?} iosPollEnabled
     * @param {?} iosPollrate
     * @param {?} zone
     */
    constructor(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        super(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone);
        this.tr = tr;
        this.vc = vc;
        this.fs = fs;
        this.cd = cd;
        this.iosPollEnabled = iosPollEnabled;
        this.iosPollrate = iosPollrate;
        this.zone = zone;
        this.elmInputKey = IF_FS_SELECTOR;
        this.showWhenFullscreen = true;
    }
}
FloFullscreenOnDirective.decorators = [
    { type: Directive, args: [{
                selector: `[${IF_FS_SELECTOR}]`,
                inputs: [IF_FS_SELECTOR]
            },] }
];
/** @nocollapse */
FloFullscreenOnDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: FloFullscreenService },
    { type: ChangeDetectorRef },
    { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
    { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
    { type: NgZone }
];
if (false) {
    /** @type {?} */
    FloFullscreenOnDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.zone;
}
/** @type {?} */
const IF_NOT_FS_SELECTOR = 'floIfNotFullscreen';
export class FloFullscreenOffDirective extends FloFullscreenDirective {
    /**
     * @param {?} tr
     * @param {?} vc
     * @param {?} fs
     * @param {?} cd
     * @param {?} iosPollEnabled
     * @param {?} iosPollrate
     * @param {?} zone
     */
    constructor(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        super(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone);
        this.tr = tr;
        this.vc = vc;
        this.fs = fs;
        this.cd = cd;
        this.iosPollEnabled = iosPollEnabled;
        this.iosPollrate = iosPollrate;
        this.zone = zone;
        this.elmInputKey = IF_NOT_FS_SELECTOR;
        this.showWhenFullscreen = false;
    }
}
FloFullscreenOffDirective.decorators = [
    { type: Directive, args: [{
                selector: `[${IF_NOT_FS_SELECTOR}]`,
                inputs: [IF_NOT_FS_SELECTOR]
            },] }
];
/** @nocollapse */
FloFullscreenOffDirective.ctorParameters = () => [
    { type: TemplateRef },
    { type: ViewContainerRef },
    { type: FloFullscreenService },
    { type: ChangeDetectorRef },
    { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
    { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
    { type: NgZone }
];
if (false) {
    /** @type {?} */
    FloFullscreenOffDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZnVsbHNjcmVlbi5zd2l0Y2guZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZsb3Nwb3J0c2luYy9uZy1mdWxsc2NyZWVuLyIsInNvdXJjZXMiOlsic3JjL3N3aXRjaC9uZy1mdWxsc2NyZWVuLnN3aXRjaC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixFQUNkLGlCQUFpQixFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQzVELE1BQU0sZUFBZSxDQUFBO0FBQ3RCLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFDaEcsT0FBTyxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFBO0FBQ3ZELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFBO0FBQ3RFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUN6QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQTs7Ozs7QUFHMUcsTUFBTSxPQUFnQixzQkFBc0I7Ozs7Ozs7Ozs7SUFDMUMsWUFBc0IsRUFBb0IsRUFBWSxFQUFvQixFQUFZLEVBQXdCLEVBQ2xHLEVBQXFCLEVBQW9ELGNBQXVCLEVBQzdELFdBQW1CLEVBQ3RELElBQVk7UUFIRixPQUFFLEdBQUYsRUFBRSxDQUFrQjtRQUFZLE9BQUUsR0FBRixFQUFFLENBQWtCO1FBQVksT0FBRSxHQUFGLEVBQUUsQ0FBc0I7UUFDbEcsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBb0QsbUJBQWMsR0FBZCxjQUFjLENBQVM7UUFDN0QsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFDdEQsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUdQ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UCxNQUFNLFNBQUMsOEJBQThCO3lDQUN0RSxNQUFNLFNBQUMseUJBQXlCO1lBL0ZrQixNQUFNOzs7O0lBb0czRCxnREFBZ0M7Ozs7O0lBUHBCLHVDQUE4Qjs7Ozs7SUFBRSx1Q0FBOEI7Ozs7O0lBQUUsdUNBQWtDOzs7OztJQUM1Ryx1Q0FBK0I7Ozs7O0lBQUUsbURBQXlFOzs7OztJQUMxRyxnREFBZ0U7Ozs7O0lBQUUseUNBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLCBUZW1wbGF0ZVJlZiwgVmlld0NvbnRhaW5lclJlZiwgT25Jbml0LCBPbkRlc3Ryb3ksXG4gIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdCwgTmdab25lXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXG5pbXBvcnQgeyB0YWtlVW50aWwsIGZsYXRNYXAsIHN0YXJ0V2l0aCwgZGVsYXksIHRhcCwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycydcbmltcG9ydCB7IFN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIGludGVydmFsIH0gZnJvbSAncnhqcydcbmltcG9ydCB7IEZsb0Z1bGxzY3JlZW5TZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL25nLWZ1bGxzY3JlZW4uc2VydmljZSdcbmltcG9ydCB7IGlzSXBob25lIH0gZnJvbSAnLi4vY29tbW9uL3V0aWwnXG5pbXBvcnQgeyBGU19GVUxMU0NSRUVOX0lPU19QT0xMX01TLCBGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQgfSBmcm9tICcuLi9jb21tb24vbmctZnVsbHNjcmVlbi50b2tlbnMnXG5cbi8vIHRzbGludDpkaXNhYmxlOiByZWFkb25seS1rZXl3b3JkXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRmxvRnVsbHNjcmVlbkRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0LCBPbkNoYW5nZXMge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgdHI6IFRlbXBsYXRlUmVmPGFueT4sIHByb3RlY3RlZCB2YzogVmlld0NvbnRhaW5lclJlZiwgcHJvdGVjdGVkIGZzOiBGbG9GdWxsc2NyZWVuU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfRU5BQkxFRCkgcHJvdGVjdGVkIGlvc1BvbGxFbmFibGVkOiBib29sZWFuLFxuICAgIEBJbmplY3QoRlNfRlVMTFNDUkVFTl9JT1NfUE9MTF9NUykgcHJvdGVjdGVkIGlvc1BvbGxyYXRlOiBudW1iZXIsXG4gICAgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSkgeyB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGVsbUlucHV0S2V5Pzogc3RyaW5nXG4gIHByaXZhdGUgcmVhZG9ubHkgZWxtU291cmNlID0gbmV3IFN1YmplY3Q8SFRNTEVsZW1lbnQgfCB1bmRlZmluZWQ+KClcblxuICBwcm90ZWN0ZWQgc2hvd1doZW5GdWxsc2NyZWVuID0gZmFsc2VcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG5nT25EZXN0cm95JCA9IG5ldyBTdWJqZWN0KClcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGVsbSA9ICgpID0+IHRoaXMuZWxtSW5wdXRLZXkgPyB0aGlzW3RoaXMuZWxtSW5wdXRLZXldIGFzIEhUTUxFbGVtZW50IDogdW5kZWZpbmVkXG4gIHByb3RlY3RlZCByZWFkb25seSBlbG0kID0gdGhpcy5lbG1Tb3VyY2UuYXNPYnNlcnZhYmxlKClcblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb21iaW5lTGF0ZXN0KFxuICAgICAgdGhpcy5mcy5mdWxsc2NyZWVuJCxcbiAgICAgIHRoaXMuZWxtJC5waXBlKFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCkpLFxuICAgICAgICBzdGFydFdpdGgodGhpcy5lbG0oKSksXG4gICAgICAgIGRlbGF5KDApLFxuICAgICAgICBmbGF0TWFwKGVsbSA9PiB0aGlzLmlvc1BvbGxFbmFibGVkICYmIGlzSXBob25lKClcbiAgICAgICAgICA/IHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgICAgICAgaW50ZXJ2YWwodGhpcy5pb3NQb2xscmF0ZSkucGlwZShcbiAgICAgICAgICAgICAgZmxhdE1hcCgoKSA9PiB0aGlzLmZzLmZ1bGxzY3JlZW5Jc1N1cHBvcnRlZChlbG0pKSxcbiAgICAgICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMubmdPbkRlc3Ryb3kkKSkpXG4gICAgICAgICAgOiB0aGlzLmZzLmZ1bGxzY3JlZW5Jc1N1cHBvcnRlZChlbG0pXG4gICAgICAgICksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLm5nT25EZXN0cm95JClcbiAgICAgIClcbiAgICApLnBpcGUodGFrZVVudGlsKHRoaXMubmdPbkRlc3Ryb3kkKSkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICBjb25zdCBpc0Z1bGxzY3JlZW4gPSByZXNbMF1cbiAgICAgIGNvbnN0IGlzU3VwcG9ydGVkID0gcmVzWzFdXG4gICAgICB0aGlzLnZjLmNsZWFyKClcbiAgICAgIGlmICh0aGlzLnNob3dXaGVuRnVsbHNjcmVlbikgeyAvLyBleGl0XG4gICAgICAgIGlmIChpc0Z1bGxzY3JlZW4pIHtcbiAgICAgICAgICB0aGlzLnZjLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLnRyKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFpc0Z1bGxzY3JlZW4pIHsgLy8gZW50ZXJcbiAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7XG4gICAgICAgICAgdGhpcy52Yy5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50cilcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKClcbiAgICB9KVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoc2M6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAodGhpcy5lbG1JbnB1dEtleSAmJiBzY1t0aGlzLmVsbUlucHV0S2V5XSkge1xuICAgICAgdGhpcy5lbG1Tb3VyY2UubmV4dChzY1t0aGlzLmVsbUlucHV0S2V5XS5jdXJyZW50VmFsdWUpXG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ09uRGVzdHJveSQubmV4dCgpXG4gICAgdGhpcy5uZ09uRGVzdHJveSQuY29tcGxldGUoKVxuICB9XG59XG5cbmNvbnN0IElGX0ZTX1NFTEVDVE9SID0gJ2Zsb0lmRnVsbHNjcmVlbidcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiBgWyR7SUZfRlNfU0VMRUNUT1J9XWAsXG4gIGlucHV0czogW0lGX0ZTX1NFTEVDVE9SXVxufSlcbmV4cG9ydCBjbGFzcyBGbG9GdWxsc2NyZWVuT25EaXJlY3RpdmUgZXh0ZW5kcyBGbG9GdWxsc2NyZWVuRGlyZWN0aXZlIHtcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHRyOiBUZW1wbGF0ZVJlZjxhbnk+LCBwcm90ZWN0ZWQgdmM6IFZpZXdDb250YWluZXJSZWYsIHByb3RlY3RlZCBmczogRmxvRnVsbHNjcmVlblNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgQEluamVjdChGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQpIHByb3RlY3RlZCBpb3NQb2xsRW5hYmxlZDogYm9vbGVhbixcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMpIHByb3RlY3RlZCBpb3NQb2xscmF0ZTogbnVtYmVyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lKSB7XG4gICAgc3VwZXIodHIsIHZjLCBmcywgY2QsIGlvc1BvbGxFbmFibGVkLCBpb3NQb2xscmF0ZSwgem9uZSlcbiAgICB0aGlzLnNob3dXaGVuRnVsbHNjcmVlbiA9IHRydWVcbiAgfVxuXG4gIGVsbUlucHV0S2V5ID0gSUZfRlNfU0VMRUNUT1Jcbn1cblxuY29uc3QgSUZfTk9UX0ZTX1NFTEVDVE9SID0gJ2Zsb0lmTm90RnVsbHNjcmVlbidcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiBgWyR7SUZfTk9UX0ZTX1NFTEVDVE9SfV1gLFxuICBpbnB1dHM6IFtJRl9OT1RfRlNfU0VMRUNUT1JdXG59KVxuZXhwb3J0IGNsYXNzIEZsb0Z1bGxzY3JlZW5PZmZEaXJlY3RpdmUgZXh0ZW5kcyBGbG9GdWxsc2NyZWVuRGlyZWN0aXZlIHtcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHRyOiBUZW1wbGF0ZVJlZjxhbnk+LCBwcm90ZWN0ZWQgdmM6IFZpZXdDb250YWluZXJSZWYsIHByb3RlY3RlZCBmczogRmxvRnVsbHNjcmVlblNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgQEluamVjdChGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQpIHByb3RlY3RlZCBpb3NQb2xsRW5hYmxlZDogYm9vbGVhbixcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMpIHByb3RlY3RlZCBpb3NQb2xscmF0ZTogbnVtYmVyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lKSB7XG4gICAgc3VwZXIodHIsIHZjLCBmcywgY2QsIGlvc1BvbGxFbmFibGVkLCBpb3NQb2xscmF0ZSwgem9uZSlcbiAgICB0aGlzLnNob3dXaGVuRnVsbHNjcmVlbiA9IGZhbHNlXG4gIH1cblxuICBlbG1JbnB1dEtleSA9IElGX05PVF9GU19TRUxFQ1RPUlxufVxuIl19