/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isIphone } from './util';
import { DOCUMENT, isPlatformServer } from '@angular/common';
import { Injectable, Inject, PLATFORM_ID, NgZone } from '@angular/core';
import { merge, fromEvent, throwError, of, interval, BehaviorSubject, EMPTY } from 'rxjs';
import { debounceTime, map, startWith, shareReplay, filter, flatMap, tap, distinctUntilChanged, take, takeUntil } from 'rxjs/operators';
import { FS_FULLSCREEN_REQUEST_EVENTS, FS_FULLSCREEN_EXIT_EVENTS, FS_FULLSCREEN_ELEMENT, FS_FULLSCREEN_CHANGE_EVENTS, FS_FULLSCREEN_ELEMENT_ERROR_EVENTS, FS_FULLSCREEN_ENABLED, FS_FULLSCREEN_ENABLED_FUNC, FS_FULLSCREEN_IOS_POLL_MS, FS_FULLSCREEN_IOS_POLL_ENABLED } from './ng-fullscreen.tokens';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./ng-fullscreen.tokens";
/** @type {?} */
const isKeyTrue = (/**
 * @param {?} platformKeys
 * @return {?}
 */
(platformKeys) => (/**
 * @param {?} doc
 * @return {?}
 */
(doc) => platformKeys.reduce((/**
 * @param {?} acc
 * @param {?} curr
 * @return {?}
 */
(acc, curr) => acc || doc[curr] ? true : false), false)));
const ɵ0 = isKeyTrue;
/** @type {?} */
const fullscreenChangeError = (/**
 * @param {?} platformKeys
 * @return {?}
 */
(platformKeys) => (/**
 * @param {?} doc
 * @return {?}
 */
(doc) => merge(...platformKeys.map((/**
 * @param {?} key
 * @return {?}
 */
key => fromEvent(doc, key)))).pipe(debounceTime(0))));
const ɵ1 = fullscreenChangeError;
/** @type {?} */
const filterAndExecute = (/**
 * @param {?} ref
 * @return {?}
 */
(ref) => (/**
 * @param {?} arr
 * @return {?}
 */
(arr) => {
    /** @type {?} */
    const funcStringIdx = arr.findIndex((/**
     * @param {?} a
     * @return {?}
     */
    a => typeof ref[a] === 'function'));
    if (funcStringIdx >= 0) {
        ref[arr[funcStringIdx]]();
    }
}));
const ɵ2 = filterAndExecute;
/**
 * @record
 */
export function IFloFullscreenService() { }
if (false) {
    /** @type {?} */
    IFloFullscreenService.prototype.fullscreen$;
    /** @type {?} */
    IFloFullscreenService.prototype.isFullscreen$;
    /** @type {?} */
    IFloFullscreenService.prototype.isNotFullscreen;
    /** @type {?} */
    IFloFullscreenService.prototype.exitFullscreen;
    /** @type {?} */
    IFloFullscreenService.prototype.goFullscreen;
    /** @type {?} */
    IFloFullscreenService.prototype.canGoFullscreen;
    /** @type {?} */
    IFloFullscreenService.prototype.fullscreenIsSupported;
    /** @type {?} */
    IFloFullscreenService.prototype.isFullscreen;
}
export class FloFullscreenService {
    // tslint:disable: readonly-array
    /**
     * @param {?} zone
     * @param {?} doc
     * @param {?} platformId
     * @param {?} requestEventKeys
     * @param {?} exitEventKeys
     * @param {?} elementKeys
     * @param {?} changeEventKeys
     * @param {?} elementErrorEventKeys
     * @param {?} enabledKeys
     * @param {?} enabledFunc
     * @param {?} iosPollrate
     * @param {?} iosPollEnabled
     */
    constructor(zone, doc, platformId, requestEventKeys, exitEventKeys, elementKeys, changeEventKeys, elementErrorEventKeys, enabledKeys, enabledFunc, iosPollrate, iosPollEnabled) {
        this.zone = zone;
        this.doc = doc;
        this.platformId = platformId;
        this.requestEventKeys = requestEventKeys;
        this.exitEventKeys = exitEventKeys;
        this.elementKeys = elementKeys;
        this.changeEventKeys = changeEventKeys;
        this.elementErrorEventKeys = elementErrorEventKeys;
        this.enabledKeys = enabledKeys;
        this.enabledFunc = enabledFunc;
        this.iosPollrate = iosPollrate;
        this.iosPollEnabled = iosPollEnabled;
        this.iOSVideoState = new BehaviorSubject(false);
        this.isFullscreen = (/**
         * @param {?=} doc
         * @return {?}
         */
        (doc = this.doc) => isPlatformServer(this.platformId) ? false : isKeyTrue(this.elementKeys)(doc) || this.iOSVideoState.getValue());
        this.fullscreenError$ = fullscreenChangeError(this.elementErrorEventKeys)(this.doc).pipe(map((/**
         * @param {?} e
         * @return {?}
         */
        e => throwError(e))));
        this.iosVideoBypass = (/**
         * @param {?} pasthrough
         * @return {?}
         */
        (pasthrough) => isIphone() ? ['webkitEnterFullscreen'] : pasthrough);
        this.extractVideoForIphoneIfRequired = (/**
         * @param {?} element
         * @return {?}
         */
        (element) => isIphone() && !(element instanceof HTMLVideoElement)
            ? element.querySelector('video') || element
            : element);
        this.iosPoller = (/**
         * @return {?}
         */
        () => !this.iosPollEnabled
            ? EMPTY
            : this.zone.runOutsideAngular((/**
             * @return {?}
             */
            () => interval(this.iosPollrate).pipe(map((/**
             * @return {?}
             */
            () => Array.from(((/** @type {?} */ (this.doc))).querySelectorAll('video')))), flatMap((/**
             * @param {?} videoElements
             * @return {?}
             */
            videoElements => merge(...videoElements.map((/**
             * @param {?} ve
             * @return {?}
             */
            ve => fromEvent(ve, 'webkitbeginfullscreen').pipe(tap((/**
             * @return {?}
             */
            () => this.iOSVideoState.next(true))), take(1)))), ...videoElements.map((/**
             * @param {?} ve
             * @return {?}
             */
            ve => fromEvent(ve, 'webkitendfullscreen').pipe(tap((/**
             * @return {?}
             */
            () => this.iOSVideoState.next(false))), take(1))))))), takeUntil(this.iOSVideoState)))));
        this.fullscreen$ = isPlatformServer(this.platformId)
            ? of(false)
            : merge(...this.changeEventKeys.map((/**
             * @param {?} key
             * @return {?}
             */
            key => fromEvent(this.doc, key))), this.fullscreenError$, this.iosPoller()).pipe(debounceTime(0), map((/**
             * @return {?}
             */
            () => this.isFullscreen())), distinctUntilChanged(), startWith(this.isFullscreen()), shareReplay(1));
        this.fullscreenIsSupported = (/**
         * @param {?=} elm
         * @return {?}
         */
        (elm) => (isPlatformServer(this.platformId)
            ? of(false)
            : isKeyTrue(this.enabledKeys)(this.doc)
                ? of(true)
                : !elm
                    ? of(false)
                    : this.enabledFunc(elm)).pipe(shareReplay(1)));
        this.canGoFullscreen = (/**
         * @param {?=} elm
         * @return {?}
         */
        (elm) => (isPlatformServer(this.platformId)
            ? of(false)
            : this.fullscreenIsSupported(elm)
                .pipe(flatMap((/**
             * @param {?} isSupported
             * @return {?}
             */
            isSupported => !isSupported
                ? of(false)
                : this.fullscreen$.pipe(map((/**
                 * @param {?} isfs
                 * @return {?}
                 */
                isfs => isfs ? false : true))))))).pipe(shareReplay(1)));
        this.isFullscreen$ = this.fullscreen$.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v === true)));
        this.isNotFullscreen = this.fullscreen$.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v === false)));
        this.exitFullscreen = (/**
         * @return {?}
         */
        () => filterAndExecute(this.doc)(this.exitEventKeys));
        this.goFullscreen = (/**
         * @param {?=} elm
         * @return {?}
         */
        (elm = this.doc.body) => filterAndExecute(elm)(this.iosVideoBypass(this.requestEventKeys)));
    }
}
FloFullscreenService.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
/** @nocollapse */
FloFullscreenService.ctorParameters = () => [
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: String, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_REQUEST_EVENTS,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_EXIT_EVENTS,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_ELEMENT,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_CHANGE_EVENTS,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_ELEMENT_ERROR_EVENTS,] }] },
    { type: Array, decorators: [{ type: Inject, args: [FS_FULLSCREEN_ENABLED,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [FS_FULLSCREEN_ENABLED_FUNC,] }] },
    { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
    { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] }
];
/** @nocollapse */ FloFullscreenService.ngInjectableDef = i0.defineInjectable({ factory: function FloFullscreenService_Factory() { return new FloFullscreenService(i0.inject(i0.NgZone), i0.inject(i1.DOCUMENT), i0.inject(i0.PLATFORM_ID), i0.inject(i2.FS_FULLSCREEN_REQUEST_EVENTS), i0.inject(i2.FS_FULLSCREEN_EXIT_EVENTS), i0.inject(i2.FS_FULLSCREEN_ELEMENT), i0.inject(i2.FS_FULLSCREEN_CHANGE_EVENTS), i0.inject(i2.FS_FULLSCREEN_ELEMENT_ERROR_EVENTS), i0.inject(i2.FS_FULLSCREEN_ENABLED), i0.inject(i2.FS_FULLSCREEN_ENABLED_FUNC), i0.inject(i2.FS_FULLSCREEN_IOS_POLL_MS), i0.inject(i2.FS_FULLSCREEN_IOS_POLL_ENABLED)); }, token: FloFullscreenService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.iOSVideoState;
    /** @type {?} */
    FloFullscreenService.prototype.isFullscreen;
    /** @type {?} */
    FloFullscreenService.prototype.fullscreenError$;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.iosVideoBypass;
    /** @type {?} */
    FloFullscreenService.prototype.extractVideoForIphoneIfRequired;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.iosPoller;
    /** @type {?} */
    FloFullscreenService.prototype.fullscreen$;
    /** @type {?} */
    FloFullscreenService.prototype.fullscreenIsSupported;
    /** @type {?} */
    FloFullscreenService.prototype.canGoFullscreen;
    /** @type {?} */
    FloFullscreenService.prototype.isFullscreen$;
    /** @type {?} */
    FloFullscreenService.prototype.isNotFullscreen;
    /** @type {?} */
    FloFullscreenService.prototype.exitFullscreen;
    /** @type {?} */
    FloFullscreenService.prototype.goFullscreen;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.doc;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.platformId;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.requestEventKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.exitEventKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.elementKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.changeEventKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.elementErrorEventKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.enabledKeys;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.enabledFunc;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.iosPollrate;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenService.prototype.iosPollEnabled;
}
export { ɵ0, ɵ1, ɵ2 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZnVsbHNjcmVlbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZsb3Nwb3J0c2luYy9uZy1mdWxsc2NyZWVuLyIsInNvdXJjZXMiOlsic3JjL2NvbW1vbi9uZy1mdWxsc2NyZWVuLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFDakMsT0FBTyxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFBO0FBQzVELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDdkUsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQWMsVUFBVSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQTtBQUNyRyxPQUFPLEVBQ0wsWUFBWSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUMvRCxvQkFBb0IsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUN0QyxNQUFNLGdCQUFnQixDQUFBO0FBQ3ZCLE9BQU8sRUFDTCw0QkFBNEIsRUFBRSx5QkFBeUIsRUFBRSxxQkFBcUIsRUFDOUUsMkJBQTJCLEVBQUUsa0NBQWtDLEVBRS9ELHFCQUFxQixFQUF5QiwwQkFBMEIsRUFDeEUseUJBQXlCLEVBQUUsOEJBQThCLEVBQzFELE1BQU0sd0JBQXdCLENBQUE7Ozs7O01BRXpCLFNBQVM7Ozs7QUFDYixDQUFDLFlBQW1DLEVBQUUsRUFBRTs7OztBQUN0QyxDQUFDLEdBQStCLEVBQUUsRUFBRSxDQUNsQyxZQUFZLENBQUMsTUFBTTs7Ozs7QUFBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FB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LENBQUMsQ0FBQyxFQUFBO0lBM0QvRCxDQUFDOzs7WUFoQk4sVUFBVSxTQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRTs7OztZQTVDUSxNQUFNOzRDQWlEM0MsTUFBTSxTQUFDLFFBQVE7eUNBQ2YsTUFBTSxTQUFDLFdBQVc7d0NBQ2xCLE1BQU0sU0FBQyw0QkFBNEI7d0NBQ25DLE1BQU0sU0FBQyx5QkFBeUI7d0NBQ2hDLE1BQU0sU0FBQyxxQkFBcUI7d0NBQzVCLE1BQU0sU0FBQywyQkFBMkI7d0NBQ2xDLE1BQU0sU0FBQyxrQ0FBa0M7d0NBQ3pDLE1BQU0sU0FBQyxxQkFBcUI7NENBQzVCLE1BQU0sU0FBQywwQkFBMEI7eUNBQ2pDLE1BQU0sU0FBQyx5QkFBeUI7MENBQ2hDLE1BQU0sU0FBQyw4QkFBOEI7Ozs7Ozs7O0lBR3hDLDZDQUFvRTs7SUFFcEUsNENBQytHOztJQUUvRyxnREFBNEg7Ozs7O0lBRTVILDhDQUErRzs7SUFDL0csK0RBRVc7Ozs7O0lBRVgseUNBUXlDOztJQUV6QywyQ0FVcUI7O0lBRXJCLHFEQVF1RDs7SUFFdkQsK0NBTzJGOztJQUUzRiw2Q0FBOEU7O0lBQzlFLCtDQUFpRjs7SUFDakYsOENBQXFGOztJQUNyRiw0Q0FDbUU7Ozs7O0lBdkVqRSxvQ0FBb0I7Ozs7O0lBQ3BCLG1DQUFrQzs7Ozs7SUFDbEMsMENBQStDOzs7OztJQUMvQyxnREFBeUY7Ozs7O0lBQ3pGLDZDQUFnRjs7Ozs7SUFDaEYsMkNBQTJFOzs7OztJQUMzRSwrQ0FBc0Y7Ozs7O0lBQ3RGLHFEQUFrRzs7Ozs7SUFDbEcsMkNBQTJFOzs7OztJQUMzRSwyQ0FBOEU7Ozs7O0lBQzlFLDJDQUE4RDs7Ozs7SUFDOUQsOENBQXVFIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBpc0lwaG9uZSB9IGZyb20gJy4vdXRpbCdcbmltcG9ydCB7IERPQ1VNRU5ULCBpc1BsYXRmb3JtU2VydmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJ1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBQTEFURk9STV9JRCwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSdcbmltcG9ydCB7IG1lcmdlLCBmcm9tRXZlbnQsIE9ic2VydmFibGUsIHRocm93RXJyb3IsIG9mLCBpbnRlcnZhbCwgQmVoYXZpb3JTdWJqZWN0LCBFTVBUWSB9IGZyb20gJ3J4anMnXG5pbXBvcnQge1xuICBkZWJvdW5jZVRpbWUsIG1hcCwgc3RhcnRXaXRoLCBzaGFyZVJlcGxheSwgZmlsdGVyLCBmbGF0TWFwLCB0YXAsXG4gIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCB0YWtlLCB0YWtlVW50aWxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnXG5pbXBvcnQge1xuICBGU19GVUxMU0NSRUVOX1JFUVVFU1RfRVZFTlRTLCBGU19GVUxMU0NSRUVOX0VYSVRfRVZFTlRTLCBGU19GVUxMU0NSRUVOX0VMRU1FTlQsXG4gIEZTX0ZVTExTQ1JFRU5fQ0hBTkdFX0VWRU5UUywgRlNfRlVMTFNDUkVFTl9FTEVNRU5UX0VSUk9SX0VWRU5UUywgRnVsbHNjcmVlblJlcXVlc3RFdmVudHMsXG4gIEZ1bGxzY3JlZW5FeGl0RXZlbnRzLCBGdWxsc2NyZWVuRWxlbWVudEtleXMsIEZ1bGxzY3JlZW5DaGFuZ2VFdmVudHMsIEZ1bGxzY3JlZW5FcnJvckV2ZW50cyxcbiAgRlNfRlVMTFNDUkVFTl9FTkFCTEVELCBGdWxsc2NyZWVuRW5hYmxlZEtleXMsIEZTX0ZVTExTQ1JFRU5fRU5BQkxFRF9GVU5DLCBGdWxsc2NyZWVuRW5hYmxlZEZ1bmMsXG4gIEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMsIEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfRU5BQkxFRFxufSBmcm9tICcuL25nLWZ1bGxzY3JlZW4udG9rZW5zJ1xuXG5jb25zdCBpc0tleVRydWUgPVxuICAocGxhdGZvcm1LZXlzOiBSZWFkb25seUFycmF5PHN0cmluZz4pID0+XG4gICAgKGRvYzogSFRNTERvY3VtZW50IHwgSFRNTEVsZW1lbnQpID0+XG4gICAgICBwbGF0Zm9ybUtleXMucmVkdWNlKChhY2MsIGN1cnIpID0+IGFjYyB8fCBkb2NbY3Vycl0gPyB0cnVlIDogZmFsc2UsIGZhbHNlKVxuXG5jb25zdCBmdWxsc2NyZWVuQ2hhbmdlRXJyb3IgPVxuICAocGxhdGZvcm1LZXlzOiBSZWFkb25seUFycmF5PHN0cmluZz4pID0+XG4gICAgKGRvYzogSFRNTERvY3VtZW50KSA9PlxuICAgICAgbWVyZ2UoLi4ucGxhdGZvcm1LZXlzLm1hcChrZXkgPT4gZnJvbUV2ZW50KGRvYywga2V5KSkpLnBpcGUoZGVib3VuY2VUaW1lKDApKVxuXG5jb25zdCBmaWx0ZXJBbmRFeGVjdXRlID1cbiAgKHJlZjogSFRNTEVsZW1lbnQgfCBIVE1MRG9jdW1lbnQpID0+XG4gICAgKGFycjogUmVhZG9ubHlBcnJheTxzdHJpbmc+KSA9PiB7XG4gICAgICBjb25zdCBmdW5jU3RyaW5nSWR4ID0gYXJyLmZpbmRJbmRleChhID0+IHR5cGVvZiByZWZbYV0gPT09ICdmdW5jdGlvbicpXG4gICAgICBpZiAoZnVuY1N0cmluZ0lkeCA+PSAwKSB7XG4gICAgICAgIHJlZlthcnJbZnVuY1N0cmluZ0lkeF1dKClcbiAgICAgIH1cbiAgICB9XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZsb0Z1bGxzY3JlZW5TZXJ2aWNlIHtcbiAgcmVhZG9ubHkgZnVsbHNjcmVlbiQ6IE9ic2VydmFibGU8Ym9vbGVhbj5cbiAgcmVhZG9ubHkgaXNGdWxsc2NyZWVuJDogT2JzZXJ2YWJsZTxib29sZWFuPlxuICByZWFkb25seSBpc05vdEZ1bGxzY3JlZW46IE9ic2VydmFibGU8Ym9vbGVhbj5cbiAgcmVhZG9ubHkgZXhpdEZ1bGxzY3JlZW46ICgpID0+IHZvaWRcbiAgcmVhZG9ubHkgZ29GdWxsc2NyZWVuOiAoZWxtPzogSFRNTEVsZW1lbnQgfCBIVE1MRG9jdW1lbnQpID0+IHZvaWRcbiAgcmVhZG9ubHkgY2FuR29GdWxsc2NyZWVuOiAoZWxtPzogSFRNTEVsZW1lbnQpID0+IE9ic2VydmFibGU8Ym9vbGVhbj5cbiAgcmVhZG9ubHkgZnVsbHNjcmVlbklzU3VwcG9ydGVkOiAoZWxtPzogSFRNTEVsZW1lbnQpID0+IE9ic2VydmFibGU8Ym9vbGVhbj5cbiAgcmVhZG9ubHkgaXNGdWxsc2NyZWVuOiAoZWxtT3JEb2M6IEhUTUxEb2N1bWVudCB8IEhUTUxFbGVtZW50KSA9PiBib29sZWFuXG59XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgRmxvRnVsbHNjcmVlblNlcnZpY2UgaW1wbGVtZW50cyBJRmxvRnVsbHNjcmVlblNlcnZpY2Uge1xuICAvLyB0c2xpbnQ6ZGlzYWJsZTogcmVhZG9ubHktYXJyYXlcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2M6IGFueSxcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IHN0cmluZyxcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fUkVRVUVTVF9FVkVOVFMpIHByaXZhdGUgcmVxdWVzdEV2ZW50S2V5czogRnVsbHNjcmVlblJlcXVlc3RFdmVudHNbXSxcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fRVhJVF9FVkVOVFMpIHByaXZhdGUgZXhpdEV2ZW50S2V5czogRnVsbHNjcmVlbkV4aXRFdmVudHNbXSxcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fRUxFTUVOVCkgcHJpdmF0ZSBlbGVtZW50S2V5czogRnVsbHNjcmVlbkVsZW1lbnRLZXlzW10sXG4gICAgQEluamVjdChGU19GVUxMU0NSRUVOX0NIQU5HRV9FVkVOVFMpIHByaXZhdGUgY2hhbmdlRXZlbnRLZXlzOiBGdWxsc2NyZWVuQ2hhbmdlRXZlbnRzW10sXG4gICAgQEluamVjdChGU19GVUxMU0NSRUVOX0VMRU1FTlRfRVJST1JfRVZFTlRTKSBwcml2YXRlIGVsZW1lbnRFcnJvckV2ZW50S2V5czogRnVsbHNjcmVlbkVycm9yRXZlbnRzW10sXG4gICAgQEluamVjdChGU19GVUxMU0NSRUVOX0VOQUJMRUQpIHByaXZhdGUgZW5hYmxlZEtleXM6IEZ1bGxzY3JlZW5FbmFibGVkS2V5c1tdLFxuICAgIEBJbmplY3QoRlNfRlVMTFNDUkVFTl9FTkFCTEVEX0ZVTkMpIHByaXZhdGUgZW5hYmxlZEZ1bmM6IEZ1bGxzY3JlZW5FbmFibGVkRnVuYyxcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMpIHByaXZhdGUgaW9zUG9sbHJhdGU6IG51bWJlcixcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfRU5BQkxFRCkgcHJpdmF0ZSBpb3NQb2xsRW5hYmxlZDogYm9vbGVhblxuICApIHsgfVxuXG4gIHByaXZhdGUgcmVhZG9ubHkgaU9TVmlkZW9TdGF0ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpXG5cbiAgcHVibGljIHJlYWRvbmx5IGlzRnVsbHNjcmVlbiA9IChkb2M6IEhUTUxEb2N1bWVudCB8IEhUTUxFbGVtZW50ID0gdGhpcy5kb2MpID0+XG4gICAgaXNQbGF0Zm9ybVNlcnZlcih0aGlzLnBsYXRmb3JtSWQpID8gZmFsc2UgOiBpc0tleVRydWUodGhpcy5lbGVtZW50S2V5cykoZG9jKSB8fCB0aGlzLmlPU1ZpZGVvU3RhdGUuZ2V0VmFsdWUoKVxuXG4gIHB1YmxpYyByZWFkb25seSBmdWxsc2NyZWVuRXJyb3IkID0gZnVsbHNjcmVlbkNoYW5nZUVycm9yKHRoaXMuZWxlbWVudEVycm9yRXZlbnRLZXlzKSh0aGlzLmRvYykucGlwZShtYXAoZSA9PiB0aHJvd0Vycm9yKGUpKSlcblxuICBwcml2YXRlIHJlYWRvbmx5IGlvc1ZpZGVvQnlwYXNzID0gKHBhc3Rocm91Z2g6IHN0cmluZ1tdKSA9PiBpc0lwaG9uZSgpID8gWyd3ZWJraXRFbnRlckZ1bGxzY3JlZW4nXSA6IHBhc3Rocm91Z2hcbiAgcHVibGljIHJlYWRvbmx5IGV4dHJhY3RWaWRlb0ZvcklwaG9uZUlmUmVxdWlyZWQgPSAoZWxlbWVudDogSFRNTEVsZW1lbnQpID0+IGlzSXBob25lKCkgJiYgIShlbGVtZW50IGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudClcbiAgICA/IGVsZW1lbnQucXVlcnlTZWxlY3RvcigndmlkZW8nKSB8fCBlbGVtZW50XG4gICAgOiBlbGVtZW50XG5cbiAgcHJpdmF0ZSByZWFkb25seSBpb3NQb2xsZXIgPSAoKSA9PiAhdGhpcy5pb3NQb2xsRW5hYmxlZFxuICAgID8gRU1QVFlcbiAgICA6IHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgaW50ZXJ2YWwodGhpcy5pb3NQb2xscmF0ZSkucGlwZShcbiAgICAgICAgbWFwKCgpID0+IEFycmF5LmZyb20oKHRoaXMuZG9jIGFzIEhUTUxEb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbCgndmlkZW8nKSkpLFxuICAgICAgICBmbGF0TWFwKHZpZGVvRWxlbWVudHMgPT4gbWVyZ2UoXG4gICAgICAgICAgLi4udmlkZW9FbGVtZW50cy5tYXAodmUgPT4gZnJvbUV2ZW50KHZlLCAnd2Via2l0YmVnaW5mdWxsc2NyZWVuJykucGlwZSh0YXAoKCkgPT4gdGhpcy5pT1NWaWRlb1N0YXRlLm5leHQodHJ1ZSkpLCB0YWtlKDEpKSksXG4gICAgICAgICAgLi4udmlkZW9FbGVtZW50cy5tYXAodmUgPT4gZnJvbUV2ZW50KHZlLCAnd2Via2l0ZW5kZnVsbHNjcmVlbicpLnBpcGUodGFwKCgpID0+IHRoaXMuaU9TVmlkZW9TdGF0ZS5uZXh0KGZhbHNlKSksIHRha2UoMSkpKVxuICAgICAgICApKSwgdGFrZVVudGlsKHRoaXMuaU9TVmlkZW9TdGF0ZSkpKVxuXG4gIHB1YmxpYyByZWFkb25seSBmdWxsc2NyZWVuJCA9IGlzUGxhdGZvcm1TZXJ2ZXIodGhpcy5wbGF0Zm9ybUlkKVxuICAgID8gb2YoZmFsc2UpXG4gICAgOiBtZXJnZShcbiAgICAgIC4uLnRoaXMuY2hhbmdlRXZlbnRLZXlzLm1hcChrZXkgPT4gZnJvbUV2ZW50KHRoaXMuZG9jLCBrZXkpKSxcbiAgICAgIHRoaXMuZnVsbHNjcmVlbkVycm9yJCxcbiAgICAgIHRoaXMuaW9zUG9sbGVyKCkpLnBpcGUoXG4gICAgICAgIGRlYm91bmNlVGltZSgwKSxcbiAgICAgICAgbWFwKCgpID0+IHRoaXMuaXNGdWxsc2NyZWVuKCkpLFxuICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICBzdGFydFdpdGgodGhpcy5pc0Z1bGxzY3JlZW4oKSksXG4gICAgICAgIHNoYXJlUmVwbGF5KDEpKVxuXG4gIHB1YmxpYyByZWFkb25seSBmdWxsc2NyZWVuSXNTdXBwb3J0ZWQgPVxuICAgIChlbG0/OiBIVE1MRWxlbWVudCkgPT5cbiAgICAgIChpc1BsYXRmb3JtU2VydmVyKHRoaXMucGxhdGZvcm1JZClcbiAgICAgICAgPyBvZihmYWxzZSlcbiAgICAgICAgOiBpc0tleVRydWUodGhpcy5lbmFibGVkS2V5cykodGhpcy5kb2MpXG4gICAgICAgICAgPyBvZih0cnVlKVxuICAgICAgICAgIDogIWVsbVxuICAgICAgICAgICAgPyBvZihmYWxzZSlcbiAgICAgICAgICAgIDogdGhpcy5lbmFibGVkRnVuYyhlbG0pKS5waXBlKHNoYXJlUmVwbGF5KDEpKVxuXG4gIHB1YmxpYyByZWFkb25seSBjYW5Hb0Z1bGxzY3JlZW4gPVxuICAgIChlbG0/OiBIVE1MRWxlbWVudCkgPT5cbiAgICAgIChpc1BsYXRmb3JtU2VydmVyKHRoaXMucGxhdGZvcm1JZClcbiAgICAgICAgPyBvZihmYWxzZSlcbiAgICAgICAgOiB0aGlzLmZ1bGxzY3JlZW5Jc1N1cHBvcnRlZChlbG0pXG4gICAgICAgICAgLnBpcGUoZmxhdE1hcChpc1N1cHBvcnRlZCA9PiAhaXNTdXBwb3J0ZWRcbiAgICAgICAgICAgID8gb2YoZmFsc2UpXG4gICAgICAgICAgICA6IHRoaXMuZnVsbHNjcmVlbiQucGlwZShtYXAoaXNmcyA9PiBpc2ZzID8gZmFsc2UgOiB0cnVlKSkpKSkucGlwZShzaGFyZVJlcGxheSgxKSlcblxuICBwdWJsaWMgcmVhZG9ubHkgaXNGdWxsc2NyZWVuJCA9IHRoaXMuZnVsbHNjcmVlbiQucGlwZShmaWx0ZXIodiA9PiB2ID09PSB0cnVlKSlcbiAgcHVibGljIHJlYWRvbmx5IGlzTm90RnVsbHNjcmVlbiA9IHRoaXMuZnVsbHNjcmVlbiQucGlwZShmaWx0ZXIodiA9PiB2ID09PSBmYWxzZSkpXG4gIHB1YmxpYyByZWFkb25seSBleGl0RnVsbHNjcmVlbiA9ICgpID0+IGZpbHRlckFuZEV4ZWN1dGUodGhpcy5kb2MpKHRoaXMuZXhpdEV2ZW50S2V5cylcbiAgcHVibGljIHJlYWRvbmx5IGdvRnVsbHNjcmVlbiA9IChlbG06IEhUTUxFbGVtZW50IHwgSFRNTERvY3VtZW50ID0gdGhpcy5kb2MuYm9keSkgPT5cbiAgICBmaWx0ZXJBbmRFeGVjdXRlKGVsbSkodGhpcy5pb3NWaWRlb0J5cGFzcyh0aGlzLnJlcXVlc3RFdmVudEtleXMpKVxufVxuIl19