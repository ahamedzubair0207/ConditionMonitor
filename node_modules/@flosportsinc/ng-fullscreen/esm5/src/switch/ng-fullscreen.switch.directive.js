/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, TemplateRef, ViewContainerRef, ChangeDetectorRef, Inject, NgZone } from '@angular/core';
import { takeUntil, flatMap, startWith, delay, tap, distinctUntilChanged } from 'rxjs/operators';
import { Subject, combineLatest, interval } from 'rxjs';
import { FloFullscreenService } from '../common/ng-fullscreen.service';
import { isIphone } from '../common/util';
import { FS_FULLSCREEN_IOS_POLL_MS, FS_FULLSCREEN_IOS_POLL_ENABLED } from '../common/ng-fullscreen.tokens';
// tslint:disable: readonly-keyword
/**
 * @abstract
 */
var FloFullscreenDirective = /** @class */ (function () {
    function FloFullscreenDirective(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        var _this = this;
        this.tr = tr;
        this.vc = vc;
        this.fs = fs;
        this.cd = cd;
        this.iosPollEnabled = iosPollEnabled;
        this.iosPollrate = iosPollrate;
        this.zone = zone;
        this.elmSource = new Subject();
        this.showWhenFullscreen = false;
        this.ngOnDestroy$ = new Subject();
        this.elm = (/**
         * @return {?}
         */
        function () { return _this.elmInputKey ? (/** @type {?} */ (_this[_this.elmInputKey])) : undefined; });
        this.elm$ = this.elmSource.asObservable();
    }
    /**
     * @return {?}
     */
    FloFullscreenDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        combineLatest(this.fs.fullscreen$, this.elm$.pipe(tap((/**
         * @return {?}
         */
        function () { return _this.cd.detectChanges(); })), startWith(this.elm()), delay(0), flatMap((/**
         * @param {?} elm
         * @return {?}
         */
        function (elm) { return _this.iosPollEnabled && isIphone()
            ? _this.zone.runOutsideAngular((/**
             * @return {?}
             */
            function () {
                return interval(_this.iosPollrate).pipe(flatMap((/**
                 * @return {?}
                 */
                function () { return _this.fs.fullscreenIsSupported(elm); })), distinctUntilChanged(), takeUntil(_this.ngOnDestroy$));
            }))
            : _this.fs.fullscreenIsSupported(elm); })), takeUntil(this.ngOnDestroy$))).pipe(takeUntil(this.ngOnDestroy$)).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            /** @type {?} */
            var isFullscreen = res[0];
            /** @type {?} */
            var isSupported = res[1];
            _this.vc.clear();
            if (_this.showWhenFullscreen) { // exit
                if (isFullscreen) {
                    _this.vc.createEmbeddedView(_this.tr);
                }
            }
            else if (!isFullscreen) { // enter
                if (isSupported) {
                    _this.vc.createEmbeddedView(_this.tr);
                }
            }
            _this.cd.detectChanges();
        }));
    };
    /**
     * @param {?} sc
     * @return {?}
     */
    FloFullscreenDirective.prototype.ngOnChanges = /**
     * @param {?} sc
     * @return {?}
     */
    function (sc) {
        if (this.elmInputKey && sc[this.elmInputKey]) {
            this.elmSource.next(sc[this.elmInputKey].currentValue);
        }
    };
    /**
     * @return {?}
     */
    FloFullscreenDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.ngOnDestroy$.next();
        this.ngOnDestroy$.complete();
    };
    /** @nocollapse */
    FloFullscreenDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ViewContainerRef },
        { type: FloFullscreenService },
        { type: ChangeDetectorRef },
        { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
        { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
        { type: NgZone }
    ]; };
    return FloFullscreenDirective;
}());
export { FloFullscreenDirective };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @private
     */
    FloFullscreenDirective.prototype.elmSource;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.showWhenFullscreen;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.ngOnDestroy$;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elm;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.elm$;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenDirective.prototype.zone;
}
/** @type {?} */
var IF_FS_SELECTOR = 'floIfFullscreen';
var FloFullscreenOnDirective = /** @class */ (function (_super) {
    tslib_1.__extends(FloFullscreenOnDirective, _super);
    function FloFullscreenOnDirective(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        var _this = _super.call(this, tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) || this;
        _this.tr = tr;
        _this.vc = vc;
        _this.fs = fs;
        _this.cd = cd;
        _this.iosPollEnabled = iosPollEnabled;
        _this.iosPollrate = iosPollrate;
        _this.zone = zone;
        _this.elmInputKey = IF_FS_SELECTOR;
        _this.showWhenFullscreen = true;
        return _this;
    }
    FloFullscreenOnDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[" + IF_FS_SELECTOR + "]",
                    inputs: [IF_FS_SELECTOR]
                },] }
    ];
    /** @nocollapse */
    FloFullscreenOnDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ViewContainerRef },
        { type: FloFullscreenService },
        { type: ChangeDetectorRef },
        { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
        { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
        { type: NgZone }
    ]; };
    return FloFullscreenOnDirective;
}(FloFullscreenDirective));
export { FloFullscreenOnDirective };
if (false) {
    /** @type {?} */
    FloFullscreenOnDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOnDirective.prototype.zone;
}
/** @type {?} */
var IF_NOT_FS_SELECTOR = 'floIfNotFullscreen';
var FloFullscreenOffDirective = /** @class */ (function (_super) {
    tslib_1.__extends(FloFullscreenOffDirective, _super);
    function FloFullscreenOffDirective(tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) {
        var _this = _super.call(this, tr, vc, fs, cd, iosPollEnabled, iosPollrate, zone) || this;
        _this.tr = tr;
        _this.vc = vc;
        _this.fs = fs;
        _this.cd = cd;
        _this.iosPollEnabled = iosPollEnabled;
        _this.iosPollrate = iosPollrate;
        _this.zone = zone;
        _this.elmInputKey = IF_NOT_FS_SELECTOR;
        _this.showWhenFullscreen = false;
        return _this;
    }
    FloFullscreenOffDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[" + IF_NOT_FS_SELECTOR + "]",
                    inputs: [IF_NOT_FS_SELECTOR]
                },] }
    ];
    /** @nocollapse */
    FloFullscreenOffDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ViewContainerRef },
        { type: FloFullscreenService },
        { type: ChangeDetectorRef },
        { type: Boolean, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_ENABLED,] }] },
        { type: Number, decorators: [{ type: Inject, args: [FS_FULLSCREEN_IOS_POLL_MS,] }] },
        { type: NgZone }
    ]; };
    return FloFullscreenOffDirective;
}(FloFullscreenDirective));
export { FloFullscreenOffDirective };
if (false) {
    /** @type {?} */
    FloFullscreenOffDirective.prototype.elmInputKey;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.tr;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.vc;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.fs;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.cd;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.iosPollEnabled;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.iosPollrate;
    /**
     * @type {?}
     * @protected
     */
    FloFullscreenOffDirective.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZnVsbHNjcmVlbi5zd2l0Y2guZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZsb3Nwb3J0c2luYy9uZy1mdWxsc2NyZWVuLyIsInNvdXJjZXMiOlsic3JjL3N3aXRjaC9uZy1mdWxsc2NyZWVuLnN3aXRjaC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFFLFdBQVcsRUFBRSxnQkFBZ0IsRUFDZCxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUM1RCxNQUFNLGVBQWUsQ0FBQTtBQUN0QixPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ2hHLE9BQU8sRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQTtBQUN2RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQTtBQUN0RSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFDekMsT0FBTyxFQUFFLHlCQUF5QixFQUFFLDhCQUE4QixFQUFFLE1BQU0sZ0NBQWdDLENBQUE7Ozs7O0FBRzFHO0lBQ0UsZ0NBQXNCLEVBQW9CLEVBQVksRUFBb0IsRUFBWSxFQUF3QixFQUNsRyxFQUFxQixFQUFvRCxjQUF1QixFQUM3RCxXQUFtQixFQUN0RCxJQUFZO1FBSHhCLGlCQUc2QjtRQUhQLE9BQUUsR0FBRixFQUFFLENBQWtCO1FBQVksT0FBRSxHQUFGLEVBQUUsQ0FBa0I7UUFBWSxPQUFFLEdBQUYsRUFBRSxDQUFzQjtRQUNsRyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFvRCxtQkFBYyxHQUFkLGNBQWMsQ0FBUztRQUM3RCxnQkFBVyxHQUFYLFdBQVcsQ0FBUTtRQUN0RCxTQUFJLEdBQUosSUFBSSxDQUFRO1FBR1AsY0FBUyxHQUFHLElB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QUNULFFBQVEsRUFBRSxNQUFJLGtCQUFrQixNQUFHO29CQUNuQyxNQUFNLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQztpQkFDN0I7Ozs7Z0JBNUZZLFdBQVc7Z0JBQUUsZ0JBQWdCO2dCQUtqQyxvQkFBb0I7Z0JBSkQsaUJBQWlCOzhDQThGUCxNQUFNLFNBQUMsOEJBQThCOzZDQUN0RSxNQUFNLFNBQUMseUJBQXlCO2dCQS9Ga0IsTUFBTTs7SUFxRzdELGdDQUFDO0NBQUEsQUFiRCxDQUkrQyxzQkFBc0IsR0FTcEU7U0FUWSx5QkFBeUI7OztJQVFwQyxnREFBZ0M7Ozs7O0lBUHBCLHVDQUE4Qjs7Ozs7SUFBRSx1Q0FBOEI7Ozs7O0lBQUUsdUNBQWtDOzs7OztJQUM1Ryx1Q0FBK0I7Ozs7O0lBQUUsbURBQXlFOzs7OztJQUMxRyxnREFBZ0U7Ozs7O0lBQUUseUNBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLCBUZW1wbGF0ZVJlZiwgVmlld0NvbnRhaW5lclJlZiwgT25Jbml0LCBPbkRlc3Ryb3ksXG4gIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgQ2hhbmdlRGV0ZWN0b3JSZWYsIEluamVjdCwgTmdab25lXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXG5pbXBvcnQgeyB0YWtlVW50aWwsIGZsYXRNYXAsIHN0YXJ0V2l0aCwgZGVsYXksIHRhcCwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycydcbmltcG9ydCB7IFN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIGludGVydmFsIH0gZnJvbSAncnhqcydcbmltcG9ydCB7IEZsb0Z1bGxzY3JlZW5TZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL25nLWZ1bGxzY3JlZW4uc2VydmljZSdcbmltcG9ydCB7IGlzSXBob25lIH0gZnJvbSAnLi4vY29tbW9uL3V0aWwnXG5pbXBvcnQgeyBGU19GVUxMU0NSRUVOX0lPU19QT0xMX01TLCBGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQgfSBmcm9tICcuLi9jb21tb24vbmctZnVsbHNjcmVlbi50b2tlbnMnXG5cbi8vIHRzbGludDpkaXNhYmxlOiByZWFkb25seS1rZXl3b3JkXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRmxvRnVsbHNjcmVlbkRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0LCBPbkNoYW5nZXMge1xuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgdHI6IFRlbXBsYXRlUmVmPGFueT4sIHByb3RlY3RlZCB2YzogVmlld0NvbnRhaW5lclJlZiwgcHJvdGVjdGVkIGZzOiBGbG9GdWxsc2NyZWVuU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfRU5BQkxFRCkgcHJvdGVjdGVkIGlvc1BvbGxFbmFibGVkOiBib29sZWFuLFxuICAgIEBJbmplY3QoRlNfRlVMTFNDUkVFTl9JT1NfUE9MTF9NUykgcHJvdGVjdGVkIGlvc1BvbGxyYXRlOiBudW1iZXIsXG4gICAgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSkgeyB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGVsbUlucHV0S2V5Pzogc3RyaW5nXG4gIHByaXZhdGUgcmVhZG9ubHkgZWxtU291cmNlID0gbmV3IFN1YmplY3Q8SFRNTEVsZW1lbnQgfCB1bmRlZmluZWQ+KClcblxuICBwcm90ZWN0ZWQgc2hvd1doZW5GdWxsc2NyZWVuID0gZmFsc2VcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG5nT25EZXN0cm95JCA9IG5ldyBTdWJqZWN0KClcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGVsbSA9ICgpID0+IHRoaXMuZWxtSW5wdXRLZXkgPyB0aGlzW3RoaXMuZWxtSW5wdXRLZXldIGFzIEhUTUxFbGVtZW50IDogdW5kZWZpbmVkXG4gIHByb3RlY3RlZCByZWFkb25seSBlbG0kID0gdGhpcy5lbG1Tb3VyY2UuYXNPYnNlcnZhYmxlKClcblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb21iaW5lTGF0ZXN0KFxuICAgICAgdGhpcy5mcy5mdWxsc2NyZWVuJCxcbiAgICAgIHRoaXMuZWxtJC5waXBlKFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCkpLFxuICAgICAgICBzdGFydFdpdGgodGhpcy5lbG0oKSksXG4gICAgICAgIGRlbGF5KDApLFxuICAgICAgICBmbGF0TWFwKGVsbSA9PiB0aGlzLmlvc1BvbGxFbmFibGVkICYmIGlzSXBob25lKClcbiAgICAgICAgICA/IHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgICAgICAgaW50ZXJ2YWwodGhpcy5pb3NQb2xscmF0ZSkucGlwZShcbiAgICAgICAgICAgICAgZmxhdE1hcCgoKSA9PiB0aGlzLmZzLmZ1bGxzY3JlZW5Jc1N1cHBvcnRlZChlbG0pKSxcbiAgICAgICAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMubmdPbkRlc3Ryb3kkKSkpXG4gICAgICAgICAgOiB0aGlzLmZzLmZ1bGxzY3JlZW5Jc1N1cHBvcnRlZChlbG0pXG4gICAgICAgICksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLm5nT25EZXN0cm95JClcbiAgICAgIClcbiAgICApLnBpcGUodGFrZVVudGlsKHRoaXMubmdPbkRlc3Ryb3kkKSkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICBjb25zdCBpc0Z1bGxzY3JlZW4gPSByZXNbMF1cbiAgICAgIGNvbnN0IGlzU3VwcG9ydGVkID0gcmVzWzFdXG4gICAgICB0aGlzLnZjLmNsZWFyKClcbiAgICAgIGlmICh0aGlzLnNob3dXaGVuRnVsbHNjcmVlbikgeyAvLyBleGl0XG4gICAgICAgIGlmIChpc0Z1bGxzY3JlZW4pIHtcbiAgICAgICAgICB0aGlzLnZjLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLnRyKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFpc0Z1bGxzY3JlZW4pIHsgLy8gZW50ZXJcbiAgICAgICAgaWYgKGlzU3VwcG9ydGVkKSB7XG4gICAgICAgICAgdGhpcy52Yy5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50cilcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKClcbiAgICB9KVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoc2M6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAodGhpcy5lbG1JbnB1dEtleSAmJiBzY1t0aGlzLmVsbUlucHV0S2V5XSkge1xuICAgICAgdGhpcy5lbG1Tb3VyY2UubmV4dChzY1t0aGlzLmVsbUlucHV0S2V5XS5jdXJyZW50VmFsdWUpXG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ09uRGVzdHJveSQubmV4dCgpXG4gICAgdGhpcy5uZ09uRGVzdHJveSQuY29tcGxldGUoKVxuICB9XG59XG5cbmNvbnN0IElGX0ZTX1NFTEVDVE9SID0gJ2Zsb0lmRnVsbHNjcmVlbidcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiBgWyR7SUZfRlNfU0VMRUNUT1J9XWAsXG4gIGlucHV0czogW0lGX0ZTX1NFTEVDVE9SXVxufSlcbmV4cG9ydCBjbGFzcyBGbG9GdWxsc2NyZWVuT25EaXJlY3RpdmUgZXh0ZW5kcyBGbG9GdWxsc2NyZWVuRGlyZWN0aXZlIHtcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHRyOiBUZW1wbGF0ZVJlZjxhbnk+LCBwcm90ZWN0ZWQgdmM6IFZpZXdDb250YWluZXJSZWYsIHByb3RlY3RlZCBmczogRmxvRnVsbHNjcmVlblNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgQEluamVjdChGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQpIHByb3RlY3RlZCBpb3NQb2xsRW5hYmxlZDogYm9vbGVhbixcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMpIHByb3RlY3RlZCBpb3NQb2xscmF0ZTogbnVtYmVyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lKSB7XG4gICAgc3VwZXIodHIsIHZjLCBmcywgY2QsIGlvc1BvbGxFbmFibGVkLCBpb3NQb2xscmF0ZSwgem9uZSlcbiAgICB0aGlzLnNob3dXaGVuRnVsbHNjcmVlbiA9IHRydWVcbiAgfVxuXG4gIGVsbUlucHV0S2V5ID0gSUZfRlNfU0VMRUNUT1Jcbn1cblxuY29uc3QgSUZfTk9UX0ZTX1NFTEVDVE9SID0gJ2Zsb0lmTm90RnVsbHNjcmVlbidcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiBgWyR7SUZfTk9UX0ZTX1NFTEVDVE9SfV1gLFxuICBpbnB1dHM6IFtJRl9OT1RfRlNfU0VMRUNUT1JdXG59KVxuZXhwb3J0IGNsYXNzIEZsb0Z1bGxzY3JlZW5PZmZEaXJlY3RpdmUgZXh0ZW5kcyBGbG9GdWxsc2NyZWVuRGlyZWN0aXZlIHtcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHRyOiBUZW1wbGF0ZVJlZjxhbnk+LCBwcm90ZWN0ZWQgdmM6IFZpZXdDb250YWluZXJSZWYsIHByb3RlY3RlZCBmczogRmxvRnVsbHNjcmVlblNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgQEluamVjdChGU19GVUxMU0NSRUVOX0lPU19QT0xMX0VOQUJMRUQpIHByb3RlY3RlZCBpb3NQb2xsRW5hYmxlZDogYm9vbGVhbixcbiAgICBASW5qZWN0KEZTX0ZVTExTQ1JFRU5fSU9TX1BPTExfTVMpIHByb3RlY3RlZCBpb3NQb2xscmF0ZTogbnVtYmVyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lKSB7XG4gICAgc3VwZXIodHIsIHZjLCBmcywgY2QsIGlvc1BvbGxFbmFibGVkLCBpb3NQb2xscmF0ZSwgem9uZSlcbiAgICB0aGlzLnNob3dXaGVuRnVsbHNjcmVlbiA9IGZhbHNlXG4gIH1cblxuICBlbG1JbnB1dEtleSA9IElGX05PVF9GU19TRUxFQ1RPUlxufVxuIl19